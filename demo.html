<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Field Notes Demo — L.L.Bean User Experience</title>
  <link rel="stylesheet" href="css/tokens.css">
  <style>
    /* ============================================================
       INTERACTIVE DEMO — Field Notes by L.L.Bean
       A user-facing prototype simulating the full experience
       ============================================================ */

    /* === RESET === */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html { font-size: 16px; }
    body {
      background: #111111;
      font-family: var(--font-sans);
      color: var(--dark-text-primary);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    /* === DESKTOP WRAPPER === */
    .demo-wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 16px;
      padding: 24px;
    }

    /* === NARRATOR BAR === */
    .demo-narrator {
      max-width: 420px;
      width: 100%;
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 8px 16px;
      background: rgba(26,26,26,0.85);
      border-radius: 20px;
      backdrop-filter: blur(8px);
    }
    .narrator-dot {
      width: 8px; height: 8px;
      background: var(--dark-green-light);
      border-radius: 50%;
      flex-shrink: 0;
      animation: narrator-pulse 2s ease-in-out infinite;
    }
    @keyframes narrator-pulse {
      0%, 100% { opacity: 0.6; }
      50% { opacity: 1; }
    }
    .narrator-text {
      font-family: var(--font-sans);
      font-size: 12px;
      color: rgba(255,255,255,0.85);
      line-height: 1.4;
      flex: 1;
    }
    .narrator-toggle {
      font-family: var(--font-mono);
      font-size: 9px;
      color: rgba(255,255,255,0.4);
      background: none;
      border: 1px solid rgba(255,255,255,0.15);
      border-radius: 10px;
      padding: 3px 8px;
      cursor: pointer;
      white-space: nowrap;
    }
    .narrator-toggle:hover { color: rgba(255,255,255,0.7); border-color: rgba(255,255,255,0.3); }
    .demo-narrator.hidden { display: none; }

    /* === PHONE FRAME === */
    .demo-phone {
      width: 375px;
      height: 780px;
      border-radius: 44px;
      border: 6px solid #000000;
      background: var(--dark-bg);
      position: relative;
      overflow: hidden;
      box-shadow: 0 20px 60px rgba(0,0,0,0.5), 0 0 0 1px rgba(255,255,255,0.05);
    }
    .demo-notch {
      position: absolute;
      top: 0; left: 50%;
      transform: translateX(-50%);
      width: 150px; height: 30px;
      background: #1A1A1A;
      border-radius: 0 0 20px 20px;
      z-index: 50;
    }
    .demo-home-bar {
      position: absolute;
      bottom: 8px; left: 50%;
      transform: translateX(-50%);
      width: 120px; height: 4px;
      background: rgba(255,255,255,0.2);
      border-radius: 2px;
      z-index: 50;
    }
    .demo-screen-area {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      overflow: hidden;
    }

    /* === SCREEN SYSTEM === */
    .screen {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      display: none;
      flex-direction: column;
      overflow-y: auto;
      overflow-x: hidden;
      -webkit-overflow-scrolling: touch;
      padding-top: 44px;
      padding-bottom: 24px;
    }
    .screen.active {
      display: flex;
      animation: screen-enter 0.35s ease-out;
    }
    .screen.exit {
      display: flex;
      animation: screen-exit 0.3s ease-in forwards;
    }
    @keyframes screen-enter {
      from { transform: translateX(60px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    @keyframes screen-exit {
      from { transform: translateX(0); opacity: 1; }
      to { transform: translateX(-60px); opacity: 0; }
    }
    @keyframes screen-enter-left {
      from { transform: translateX(-60px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    /* === STATUS BAR === */
    .status-bar {
      position: absolute;
      top: 0; left: 0; right: 0;
      height: 44px;
      display: flex;
      align-items: flex-end;
      justify-content: space-between;
      padding: 0 24px 6px;
      font-family: var(--font-sans);
      font-size: 12px;
      font-weight: 600;
      color: var(--dark-text-primary);
      z-index: 40;
    }
    .status-bar.light { color: white; }

    /* === BUTTONS === */
    .demo-btn {
      font-family: var(--font-sans);
      font-size: 15px;
      font-weight: 600;
      padding: 14px 28px;
      border-radius: 12px;
      border: none;
      cursor: pointer;
      transition: transform 0.15s, opacity 0.15s;
      -webkit-tap-highlight-color: transparent;
    }
    .demo-btn:active { transform: scale(0.97); }
    .demo-btn.primary {
      background: var(--dark-green-primary);
      color: white;
      width: 100%;
    }
    .demo-btn.primary:hover { opacity: 0.9; }
    .demo-btn.secondary {
      background: var(--dark-surface);
      color: var(--dark-text-primary);
      border: 1.5px solid var(--dark-border);
    }
    .demo-btn.gold {
      background: var(--brand-ochre);
      color: white;
      width: 100%;
    }
    .demo-btn.small {
      font-size: 12px;
      padding: 8px 16px;
      border-radius: 8px;
    }
    .demo-btn.ghost {
      background: none;
      color: var(--dark-text-secondary);
      font-size: 11px;
      font-family: var(--font-mono);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      padding: 8px 16px;
      border: 1px dashed var(--dark-text-muted);
      border-radius: 8px;
    }

    /* === PROGRESS BAR === */
    .progress-track {
      width: 100%;
      height: 6px;
      background: var(--dark-surface-alt);
      border-radius: 3px;
      overflow: hidden;
    }
    .progress-fill {
      height: 100%;
      background: var(--dark-green-primary);
      border-radius: 3px;
      transition: width 0.6s ease-out;
    }

    /* ============================================================
       SCREEN 1: VENDING MACHINE
       ============================================================ */
    .screen[data-screen="vending"] {
      background: var(--dark-bg);
      padding-top: 44px;
    }
    .vending-header {
      background: var(--brand-forest);
      padding: 28px 24px 18px;
      text-align: center;
    }
    .vending-wordmark {
      font-family: var(--font-display);
      font-size: 13px;
      color: rgba(255,255,255,0.5);
      letter-spacing: 0.08em;
      display: block;
    }
    .vending-headline {
      font-family: var(--font-sans);
      font-size: 22px;
      font-weight: 800;
      color: white;
      letter-spacing: 0.04em;
    }
    .vending-badge {
      text-align: center;
      padding: 10px;
      font-family: var(--font-mono);
      font-size: 11px;
      color: var(--brand-ochre);
      letter-spacing: 0.1em;
      background: var(--dark-surface);
      border-bottom: 1px solid var(--dark-border-subtle);
    }
    .vending-photo {
      width: calc(100% - 48px);
      margin: 20px auto 0;
      aspect-ratio: 3/2;
      border-radius: 12px;
      background-size: cover;
      background-position: center;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }
    .vending-meta {
      display: flex;
      justify-content: space-between;
      padding: 14px 24px;
      font-family: var(--font-mono);
      font-size: 11px;
      color: var(--dark-text-secondary);
    }
    .vending-price {
      font-size: 18px;
      font-weight: 700;
      color: var(--dark-text-primary);
      font-family: var(--font-sans);
    }
    .vending-actions {
      padding: 0 24px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .vending-pay {
      text-align: center;
      padding: 12px;
      font-family: var(--font-mono);
      font-size: 11px;
      color: var(--dark-text-muted);
    }
    .vending-nfc { font-size: 14px; margin-right: 4px; }

    /* ============================================================
       SCREEN 2/3: PHYSICAL PRINT (front + back with 3D flip)
       ============================================================ */
    .screen[data-screen="print"] {
      background: var(--dark-bg);
      align-items: center;
      justify-content: center;
      gap: 20px;
      padding: 44px 24px 24px;
    }
    .print-scene { perspective: 1000px; }
    .print-card-3d {
      width: 210px;
      height: 315px;
      position: relative;
      transform-style: preserve-3d;
      transition: transform 0.7s ease-in-out;
    }
    .print-card-3d.flipped { transform: rotateY(180deg); }
    .print-face {
      position: absolute;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 8px 30px rgba(0,0,0,0.15);
    }
    .print-face-front {
      background: white;
      display: flex;
      flex-direction: column;
    }
    .print-face-front .print-photo-area {
      flex: 1;
      background-size: cover;
      background-position: center;
    }
    .print-face-front .print-info-bar {
      padding: 10px 14px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: white;
    }
    .print-cp {
      font-family: var(--font-mono);
      font-size: 10px;
      font-weight: 700;
      color: var(--wire-black);
      letter-spacing: 0.05em;
    }
    .print-ed {
      font-family: var(--font-mono);
      font-size: 10px;
      color: var(--wire-stroke-light);
    }
    .print-face-back {
      background: white;
      transform: rotateY(180deg);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 16px;
      padding: 24px;
    }
    .qr-visual {
      width: 80px; height: 80px;
      border: 2px solid var(--wire-black);
      border-radius: 4px;
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 2px;
      padding: 6px;
      cursor: pointer;
      transition: box-shadow 0.2s;
    }
    .qr-visual:hover { box-shadow: 0 0 0 3px rgba(44,95,45,0.4); }
    .qr-cell { background: var(--wire-black); border-radius: 1px; }
    .qr-cell.empty { background: transparent; }
    .print-caption {
      font-family: var(--font-display);
      font-size: 14px;
      color: var(--wire-stroke);
      font-style: italic;
      text-align: center;
    }
    .print-scan-cta {
      font-family: var(--font-mono);
      font-size: 9px;
      color: var(--wire-stroke-light);
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }
    .print-brand {
      margin-top: auto;
      text-align: center;
    }
    .print-brand-fn {
      font-family: var(--font-mono);
      font-size: 10px;
      font-weight: 700;
      color: var(--wire-black);
      letter-spacing: 0.1em;
      display: block;
    }
    .print-brand-ll {
      font-family: var(--font-display);
      font-size: 11px;
      color: var(--wire-stroke-light);
      display: block;
    }
    .print-instruction {
      font-family: var(--font-sans);
      font-size: 13px;
      color: var(--dark-text-secondary);
      text-align: center;
    }
    @keyframes print-dispense {
      0% { transform: translateY(-40px); opacity: 0; }
      60% { transform: translateY(6px); }
      100% { transform: translateY(0); opacity: 1; }
    }
    .print-dispensing { animation: print-dispense 0.6s cubic-bezier(0.34, 1.56, 0.64, 1); }

    /* ============================================================
       SCREEN 4: CAMERA SCAN
       ============================================================ */
    .screen[data-screen="scan"] {
      background: #111;
      padding-top: 0;
    }
    .scan-viewfinder {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
    }
    .scan-reticle {
      width: 180px; height: 180px;
      position: relative;
    }
    .scan-corner {
      position: absolute;
      width: 24px; height: 24px;
      border-color: var(--dark-green-light);
      border-style: solid;
      border-width: 0;
      transition: border-color 0.3s;
    }
    .scan-corner.tl { top: 0; left: 0; border-top-width: 3px; border-left-width: 3px; border-radius: 4px 0 0 0; }
    .scan-corner.tr { top: 0; right: 0; border-top-width: 3px; border-right-width: 3px; border-radius: 0 4px 0 0; }
    .scan-corner.bl { bottom: 0; left: 0; border-bottom-width: 3px; border-left-width: 3px; border-radius: 0 0 0 4px; }
    .scan-corner.br { bottom: 0; right: 0; border-bottom-width: 3px; border-right-width: 3px; border-radius: 0 0 4px 0; }
    .scan-corner.found { border-color: var(--brand-forest); }
    .scan-line {
      position: absolute;
      left: 8px; right: 8px;
      height: 2px;
      background: var(--dark-green-light);
      opacity: 0.7;
      border-radius: 1px;
      animation: scan-sweep 1.5s ease-in-out infinite;
    }
    @keyframes scan-sweep {
      0%, 100% { top: 12px; }
      50% { top: calc(100% - 14px); }
    }
    .scan-instruction {
      position: absolute;
      bottom: 80px;
      font-family: var(--font-sans);
      font-size: 15px;
      color: rgba(255,255,255,0.7);
    }

    /* ============================================================
       SCREEN 5: LOADING
       ============================================================ */
    .screen[data-screen="loading"] {
      background: var(--dark-bg);
      align-items: center;
      justify-content: center;
      gap: 24px;
    }
    .compass-spinner {
      width: 56px; height: 56px;
      animation: compass-spin 1.5s ease-in-out infinite;
    }
    @keyframes compass-spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    .loading-text {
      font-family: var(--font-sans);
      font-size: 16px;
      color: var(--dark-text-secondary);
      text-align: center;
      line-height: 1.5;
    }
    .loading-bar {
      width: 200px;
      height: 4px;
      background: var(--dark-surface-alt);
      border-radius: 2px;
      overflow: hidden;
    }
    .loading-bar-fill {
      width: 0;
      height: 100%;
      background: var(--dark-green-primary);
      border-radius: 2px;
    }
    .loading-bar-fill.animate {
      animation: loading-fill 2.5s ease-out forwards;
    }
    @keyframes loading-fill {
      from { width: 0; }
      to { width: 100%; }
    }

    /* ============================================================
       SCREEN 6: CARD REVEAL
       ============================================================ */
    .screen[data-screen="reveal"] {
      background: var(--dark-bg);
      align-items: center;
      justify-content: center;
      gap: 20px;
      padding: 44px 24px 24px;
    }
    .reveal-scene { perspective: 1000px; }
    .reveal-card {
      width: 200px;
      height: 280px;
      position: relative;
      transform-style: preserve-3d;
    }
    .reveal-card.flip {
      animation: card-flip-reveal 0.8s ease-out forwards;
    }
    @keyframes card-flip-reveal {
      0% { transform: rotateY(0deg) scale(0.85); }
      50% { transform: rotateY(90deg) scale(0.95); }
      100% { transform: rotateY(180deg) scale(1); }
    }
    .reveal-face {
      position: absolute;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      border-radius: 12px;
      overflow: hidden;
    }
    .reveal-back-face {
      background: var(--brand-forest);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 8px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.15);
    }
    .reveal-back-fn {
      font-family: var(--font-mono);
      font-size: 11px;
      font-weight: 700;
      color: rgba(255,255,255,0.6);
      letter-spacing: 0.15em;
    }
    .reveal-back-ll {
      font-family: var(--font-display);
      font-size: 14px;
      color: rgba(255,255,255,0.35);
    }
    .reveal-front-face {
      transform: rotateY(180deg);
      background: white;
      display: flex;
      flex-direction: column;
      box-shadow: 0 8px 30px rgba(44,95,45,0.3), 0 0 0 2px rgba(44,95,45,0.2);
    }
    .reveal-photo {
      flex: 1;
      background-size: cover;
      background-position: center;
    }
    .reveal-info {
      padding: 14px;
      text-align: center;
    }
    .reveal-name {
      font-family: var(--font-sans);
      font-size: 16px;
      font-weight: 700;
      color: var(--wire-black);
      display: block;
    }
    .reveal-edition {
      font-family: var(--font-mono);
      font-size: 10px;
      color: var(--wire-stroke-light);
      display: block;
      margin-top: 2px;
    }
    .reveal-date {
      font-family: var(--font-mono);
      font-size: 10px;
      color: var(--wire-stroke-light);
      display: block;
    }
    .reveal-caption {
      font-family: var(--font-display);
      font-size: 15px;
      color: var(--dark-text-secondary);
      font-style: italic;
      text-align: center;
    }
    .reveal-btn-wrap { width: 100%; padding: 0 24px; opacity: 0; transition: opacity 0.4s; }
    .reveal-btn-wrap.visible { opacity: 1; }

    /* ============================================================
       SCREEN 7: CONFIRMATION
       ============================================================ */
    .screen[data-screen="confirm"] {
      background: var(--dark-bg);
      align-items: center;
      justify-content: center;
      gap: 16px;
      padding: 44px 32px 24px;
    }
    .confirm-check {
      width: 60px; height: 60px;
      border-radius: 50%;
      background: var(--brand-forest);
      display: flex;
      align-items: center;
      justify-content: center;
      animation: check-pop 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    @keyframes check-pop {
      0% { transform: scale(0); opacity: 0; }
      100% { transform: scale(1); opacity: 1; }
    }
    .confirm-check svg { width: 28px; height: 28px; }
    .confirm-check path {
      stroke: white;
      stroke-width: 3;
      stroke-linecap: round;
      stroke-linejoin: round;
      fill: none;
      stroke-dasharray: 30;
      stroke-dashoffset: 30;
      animation: check-draw 0.4s 0.3s ease-out forwards;
    }
    @keyframes check-draw {
      to { stroke-dashoffset: 0; }
    }
    .confirm-title {
      font-size: 20px;
      font-weight: 700;
      text-align: center;
      line-height: 1.3;
    }
    .confirm-count {
      font-family: var(--font-mono);
      font-size: 12px;
      color: var(--dark-text-secondary);
    }
    .confirm-progress {
      width: 100%;
      max-width: 260px;
    }
    .confirm-actions {
      display: flex;
      gap: 10px;
      width: 100%;
      margin-top: 8px;
    }
    .confirm-actions .demo-btn { flex: 1; text-align: center; }

    /* ============================================================
       SCREEN 8: GALLERY
       ============================================================ */
    .screen[data-screen="gallery"] {
      background: var(--dark-bg);
    }
    .gallery-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 20px;
    }
    .gallery-title {
      font-size: 18px;
      font-weight: 700;
    }
    .gallery-share {
      font-family: var(--font-mono);
      font-size: 10px;
      color: var(--dark-green-light);
      cursor: pointer;
    }
    .gallery-progress {
      padding: 0 20px 12px;
    }
    .gallery-progress-label {
      font-family: var(--font-mono);
      font-size: 10px;
      color: var(--dark-text-secondary);
      display: block;
      margin-bottom: 6px;
    }
    .gallery-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
      padding: 0 20px;
    }
    .gallery-card {
      border-radius: 8px;
      overflow: hidden;
      cursor: pointer;
      transition: transform 0.15s;
    }
    .gallery-card:active { transform: scale(0.96); }
    .gallery-card.collected {
      background: var(--dark-surface);
      border: 1.5px solid var(--dark-border);
    }
    .gallery-card.locked {
      background: var(--dark-surface-alt);
      border: 1.5px dashed var(--dark-text-muted);
    }
    .gallery-card-photo {
      width: 100%;
      aspect-ratio: 3/4;
      background-size: cover;
      background-position: center;
    }
    .gallery-card-lock {
      width: 100%;
      aspect-ratio: 3/4;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      color: var(--dark-text-muted);
    }
    .gallery-card-name {
      font-family: var(--font-mono);
      font-size: 9px;
      color: var(--dark-text-primary);
      padding: 6px 8px 2px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .gallery-card-date {
      font-family: var(--font-mono);
      font-size: 8px;
      color: var(--dark-text-secondary);
      padding: 0 8px 6px;
    }
    .gallery-community {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 20px;
      margin-top: 8px;
      font-family: var(--font-mono);
      font-size: 10px;
      color: var(--dark-text-secondary);
      border-top: 1px solid var(--dark-border-subtle);
    }
    .gallery-map-link {
      color: var(--dark-green-light);
      cursor: pointer;
    }
    .gallery-fast-forward {
      padding: 12px 20px 0;
    }
    .tab-bar {
      margin-top: auto;
      display: flex;
      border-top: 1px solid var(--dark-border-subtle);
      background: var(--dark-surface);
      padding: 8px 0 4px;
    }
    .tab-item {
      flex: 1;
      text-align: center;
      font-family: var(--font-mono);
      font-size: 9px;
      color: var(--dark-text-muted);
      padding: 6px 0;
      cursor: pointer;
    }
    .tab-item.active {
      color: var(--dark-green-light);
      font-weight: 700;
      border-top: 2px solid var(--dark-green-primary);
      margin-top: -1px;
    }
    @keyframes card-shake {
      0%, 100% { transform: translateX(0); }
      20% { transform: translateX(-4px); }
      40% { transform: translateX(4px); }
      60% { transform: translateX(-3px); }
      80% { transform: translateX(3px); }
    }
    .gallery-card.shake { animation: card-shake 0.4s ease-out; }

    /* ============================================================
       SCREEN 9: CARD DETAIL
       ============================================================ */
    .screen[data-screen="detail"] {
      background: var(--dark-bg);
    }
    .detail-nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 20px;
    }
    .detail-back {
      font-family: var(--font-sans);
      font-size: 14px;
      color: var(--dark-green-light);
      cursor: pointer;
    }
    .detail-share {
      font-family: var(--font-mono);
      font-size: 10px;
      color: var(--dark-green-light);
      cursor: pointer;
    }
    .detail-photo {
      width: calc(100% - 40px);
      margin: 0 auto;
      aspect-ratio: 4/3;
      border-radius: 12px;
      background-size: cover;
      background-position: center;
    }
    .detail-meta {
      padding: 16px 20px 8px;
    }
    .detail-location {
      font-size: 18px;
      font-weight: 700;
      display: block;
    }
    .detail-date {
      font-family: var(--font-mono);
      font-size: 10px;
      color: var(--dark-text-secondary);
      display: block;
      margin-top: 4px;
    }
    .detail-edition {
      font-family: var(--font-mono);
      font-size: 10px;
      color: var(--dark-text-secondary);
      display: block;
    }
    .detail-story {
      margin: 12px 20px;
      padding: 12px 16px;
      border-left: 3px solid var(--dark-green-primary);
      font-family: var(--font-display);
      font-size: 14px;
      font-style: italic;
      color: var(--dark-text-secondary);
      line-height: 1.6;
      background: var(--dark-green-glow);
      border-radius: 0 8px 8px 0;
    }
    .detail-video {
      margin: 8px 20px;
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px 16px;
      background: var(--dark-surface);
      border-radius: 12px;
      cursor: pointer;
    }
    .detail-play {
      width: 36px; height: 36px;
      border-radius: 50%;
      background: var(--dark-green-primary);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      flex-shrink: 0;
    }
    .detail-video-text strong {
      font-size: 13px;
      display: block;
    }
    .detail-video-text span {
      font-family: var(--font-mono);
      font-size: 9px;
      color: var(--dark-text-secondary);
    }
    .detail-actions { padding: 16px 20px; }

    /* ============================================================
       SCREEN 10: MAP
       ============================================================ */
    .screen[data-screen="map"] {
      background: var(--dark-bg);
    }
    .map-header {
      padding: 12px 20px;
    }
    .map-title {
      font-size: 18px;
      font-weight: 700;
    }
    .map-container {
      flex: 1;
      padding: 0 12px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .map-container svg { width: 100%; max-height: 400px; }
    .map-legend {
      display: flex;
      gap: 16px;
      justify-content: center;
      padding: 8px 20px;
      font-family: var(--font-mono);
      font-size: 10px;
      color: var(--dark-text-secondary);
    }
    .map-dot {
      display: inline-block;
      width: 8px; height: 8px;
      border-radius: 50%;
      margin-right: 4px;
      vertical-align: middle;
    }
    .map-dot.collected { background: var(--dark-green-primary); }
    .map-dot.locked { border: 1.5px dashed var(--dark-text-muted); }
    .map-continue { padding: 8px 20px; }

    /* ============================================================
       SCREEN 11: RARE CARD
       ============================================================ */
    .screen[data-screen="rare"] {
      background: #1A1A1A;
      align-items: center;
      justify-content: center;
      gap: 20px;
      padding: 44px 24px 24px;
    }
    .rare-container { position: relative; }
    .rare-card-frame {
      width: 200px;
      height: 280px;
      border-radius: 12px;
      overflow: hidden;
      background: white;
      border: 3px solid var(--brand-ochre);
      box-shadow: 0 0 30px rgba(204,119,34,0.4), 0 0 60px rgba(204,119,34,0.15);
      display: flex;
      flex-direction: column;
      position: relative;
      animation: rare-entrance 0.8s ease-out;
    }
    @keyframes rare-entrance {
      0% { transform: scale(0.5); opacity: 0; }
      60% { transform: scale(1.05); }
      100% { transform: scale(1); opacity: 1; }
    }
    .rare-photo {
      flex: 1;
      background-size: cover;
      background-position: center;
    }
    .rare-info {
      padding: 12px;
      text-align: center;
      background: white;
    }
    .rare-star-label {
      font-family: var(--font-mono);
      font-size: 10px;
      font-weight: 700;
      color: var(--brand-ochre);
      letter-spacing: 0.1em;
      display: block;
    }
    .rare-title {
      font-size: 16px;
      font-weight: 700;
      display: block;
      margin: 2px 0;
    }
    .rare-ed {
      font-family: var(--font-mono);
      font-size: 10px;
      color: var(--wire-stroke-light);
    }
    .sparkle {
      position: absolute;
      width: 6px; height: 6px;
      background: var(--brand-ochre);
      border-radius: 50%;
      animation: sparkle-float 2s ease-in-out infinite;
    }
    @keyframes sparkle-float {
      0%, 100% { opacity: 0; transform: scale(0.5) translateY(0); }
      50% { opacity: 1; transform: scale(1.3) translateY(-10px); }
    }
    .rare-screen-title {
      font-family: var(--font-mono);
      font-size: 11px;
      color: rgba(255,255,255,0.4);
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    /* ============================================================
       SCREEN 12: SET COMPLETE
       ============================================================ */
    .screen[data-screen="complete"] {
      background: var(--dark-bg);
      align-items: center;
      justify-content: center;
      gap: 16px;
      padding: 44px 24px 24px;
      position: relative;
      overflow: hidden;
    }
    .complete-slots {
      display: flex;
      gap: 4px;
    }
    .complete-slot {
      width: 32px; height: 32px;
      border: 1.5px solid var(--brand-forest);
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      color: var(--brand-forest);
      opacity: 0;
      transform: scale(0.5);
    }
    .complete-slot.filled {
      animation: slot-fill 0.3s ease-out forwards;
      background: rgba(44,95,45,0.15);
    }
    @keyframes slot-fill {
      0% { opacity: 0; transform: scale(0.5); }
      60% { transform: scale(1.2); }
      100% { opacity: 1; transform: scale(1); }
    }
    .complete-badge {
      font-family: var(--font-mono);
      font-size: 12px;
      font-weight: 700;
      color: var(--brand-forest);
      letter-spacing: 0.1em;
      padding: 8px 20px;
      border: 2px solid var(--brand-forest);
      border-radius: 20px;
    }
    .complete-title {
      font-size: 20px;
      font-weight: 700;
      text-align: center;
      line-height: 1.3;
    }
    .complete-desc {
      font-family: var(--font-sans);
      font-size: 13px;
      color: var(--dark-text-secondary);
      text-align: center;
      line-height: 1.5;
    }
    .complete-bonus {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px 16px;
      background: var(--dark-surface);
      border-radius: 12px;
      width: 100%;
      max-width: 280px;
    }
    .confetti {
      position: absolute;
      width: 6px; height: 6px;
      border-radius: 1px;
      opacity: 0;
      animation: confetti-fall 3s ease-in forwards;
    }
    @keyframes confetti-fall {
      0% { transform: translateY(-20px) rotate(0deg); opacity: 1; }
      100% { transform: translateY(700px) rotate(720deg); opacity: 0; }
    }

    /* ============================================================
       SCREEN 13: COMMUNITY
       ============================================================ */
    .screen[data-screen="community"] {
      background: var(--dark-bg);
      align-items: center;
      justify-content: center;
      gap: 20px;
      padding: 44px 32px 24px;
    }
    .community-title {
      font-size: 18px;
      font-weight: 700;
    }
    .milestone-track {
      width: 100%;
      height: 10px;
      background: var(--dark-surface-alt);
      border-radius: 5px;
      overflow: hidden;
      position: relative;
    }
    .milestone-fill {
      height: 100%;
      background: var(--dark-green-primary);
      border-radius: 5px;
      transition: width 0.3s ease-out;
    }
    .milestone-count {
      font-family: var(--font-mono);
      font-size: 11px;
      color: var(--dark-text-secondary);
      text-align: center;
    }
    .community-reveal {
      text-align: center;
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.6s, transform 0.6s;
    }
    .community-reveal.visible {
      opacity: 1;
      transform: translateY(0);
    }
    .community-card {
      display: inline-block;
      padding: 20px 28px;
      border: 2px solid var(--dark-green-primary);
      border-radius: 12px;
      background: var(--dark-green-glow);
      margin-bottom: 12px;
    }
    .community-card-label {
      font-family: var(--font-mono);
      font-size: 12px;
      font-weight: 700;
      color: var(--dark-green-light);
      letter-spacing: 0.05em;
      display: block;
    }
    .community-card-text {
      font-size: 11px;
      color: var(--dark-text-secondary);
      margin-top: 4px;
    }
    .community-desc {
      font-size: 13px;
      color: var(--dark-text-secondary);
      text-align: center;
      line-height: 1.5;
    }
    .community-actions { width: 100%; margin-top: 8px; }

    /* === PROGRESS DOTS === */
    .demo-dots {
      display: flex;
      gap: 6px;
      justify-content: center;
      margin-top: 8px;
    }
    .demo-dot {
      width: 6px; height: 6px;
      border-radius: 50%;
      background: rgba(255,255,255,0.15);
      transition: background 0.3s, transform 0.3s;
    }
    .demo-dot.active {
      background: var(--dark-green-light);
      transform: scale(1.3);
    }

    /* ============================================================
       SCREEN: PROFILE
       ============================================================ */
    .screen[data-screen="profile"] {
      background: var(--dark-bg);
    }
    .profile-header {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 12px 20px;
    }
    .profile-avatar {
      width: 52px; height: 52px;
      border-radius: 50%;
      background: var(--brand-forest);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: var(--font-sans);
      font-size: 18px;
      font-weight: 700;
      flex-shrink: 0;
    }
    .profile-name {
      font-size: 18px;
      font-weight: 700;
      display: block;
    }
    .profile-handle {
      font-family: var(--font-mono);
      font-size: 11px;
      color: var(--dark-text-secondary);
    }
    .profile-stats {
      display: flex;
      gap: 1px;
      background: var(--dark-border-subtle);
      margin: 0 20px;
      border-radius: 10px;
      overflow: hidden;
    }
    .profile-stat {
      flex: 1;
      text-align: center;
      padding: 10px 8px;
      background: var(--dark-surface);
    }
    .profile-stat-num {
      font-size: 16px;
      font-weight: 700;
      display: block;
    }
    .profile-stat-label {
      font-family: var(--font-mono);
      font-size: 9px;
      color: var(--dark-text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    .profile-section-label {
      font-family: var(--font-mono);
      font-size: 10px;
      color: var(--dark-text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      padding: 16px 20px 8px;
    }
    .badge-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      padding: 0 20px;
    }
    .badge-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      background: var(--dark-surface);
      border-radius: 10px;
      border: 1px solid var(--dark-border);
    }
    .badge-item.locked { opacity: 0.45; }
    .badge-icon {
      width: 34px; height: 34px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      flex-shrink: 0;
    }
    .badge-name {
      font-size: 11px;
      font-weight: 600;
      display: block;
    }
    .badge-desc {
      font-family: var(--font-mono);
      font-size: 8px;
      color: var(--dark-text-secondary);
    }
    .profile-breakdown {
      padding: 0 20px;
    }
    .breakdown-row {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 6px 0;
    }
    .breakdown-label {
      font-family: var(--font-mono);
      font-size: 10px;
      color: var(--dark-text-secondary);
      width: 60px;
      flex-shrink: 0;
    }
    .breakdown-track {
      flex: 1;
      height: 6px;
      background: var(--dark-surface-alt);
      border-radius: 3px;
      overflow: hidden;
    }
    .breakdown-fill {
      height: 100%;
      border-radius: 3px;
      transition: width 0.4s;
    }
    .breakdown-count {
      font-family: var(--font-mono);
      font-size: 10px;
      color: var(--dark-text-secondary);
      width: 32px;
      text-align: right;
      flex-shrink: 0;
    }
    .profile-actions {
      display: flex;
      gap: 8px;
      padding: 16px 20px 0;
    }
    .profile-actions .demo-btn { flex: 1; text-align: center; font-size: 13px; }

    /* ============================================================
       SCREEN: LEADERBOARD
       ============================================================ */
    .screen[data-screen="leaderboard"] {
      background: var(--dark-bg);
    }
    .lb-nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 20px;
    }
    .lb-back {
      font-family: var(--font-sans);
      font-size: 14px;
      color: var(--dark-green-light);
      cursor: pointer;
    }
    .lb-title {
      font-size: 16px;
      font-weight: 700;
    }
    .lb-filter {
      display: flex;
      margin: 8px 20px;
      background: var(--dark-surface-alt);
      border-radius: 8px;
      overflow: hidden;
    }
    .lb-filter-btn {
      flex: 1;
      text-align: center;
      font-family: var(--font-mono);
      font-size: 10px;
      padding: 8px;
      cursor: pointer;
      background: transparent;
      border: none;
      color: var(--dark-text-muted);
      transition: background 0.2s, color 0.2s;
    }
    .lb-filter-btn.active {
      background: var(--dark-green-primary);
      color: white;
      font-weight: 700;
      border-radius: 6px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.2);
    }
    .lb-podium {
      display: flex;
      justify-content: center;
      align-items: flex-end;
      gap: 12px;
      padding: 20px 20px 16px;
    }
    .podium-item {
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
    }
    .podium-avatar {
      width: 44px; height: 44px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 700;
      color: white;
    }
    .podium-avatar.gold { background: #FFD700; border: 2px solid #E6C200; }
    .podium-avatar.silver { background: #C0C0C0; border: 2px solid #A8A8A8; }
    .podium-avatar.bronze { background: #CD7F32; border: 2px solid #B56E28; }
    .podium-name {
      font-size: 11px;
      font-weight: 600;
    }
    .podium-count {
      font-family: var(--font-mono);
      font-size: 10px;
      color: var(--dark-text-secondary);
    }
    .podium-rank {
      font-family: var(--font-mono);
      font-size: 9px;
      font-weight: 700;
      color: var(--dark-text-secondary);
    }
    .lb-list {
      padding: 0 20px;
    }
    .lb-row {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 8px;
      margin-bottom: 4px;
      background: var(--dark-surface);
      border: 1px solid var(--dark-border-subtle);
    }
    .lb-row.is-user {
      border-left: 3px solid var(--dark-green-primary);
      background: var(--dark-green-glow);
    }
    .lb-rank {
      font-family: var(--font-mono);
      font-size: 12px;
      font-weight: 700;
      color: var(--dark-text-secondary);
      width: 20px;
      text-align: center;
      flex-shrink: 0;
    }
    .lb-avatar-sm {
      width: 30px; height: 30px;
      border-radius: 50%;
      background: var(--dark-surface-alt);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      font-weight: 700;
      color: var(--dark-text-primary);
      flex-shrink: 0;
    }
    .lb-name { font-size: 13px; font-weight: 600; flex: 1; }
    .lb-score {
      font-family: var(--font-mono);
      font-size: 11px;
      color: var(--dark-text-secondary);
    }

    /* ============================================================
       SCREEN: FRIENDS
       ============================================================ */
    .screen[data-screen="friends"] {
      background: var(--dark-bg);
    }
    .friends-nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 20px;
    }
    .friends-back {
      font-family: var(--font-sans);
      font-size: 14px;
      color: var(--dark-green-light);
      cursor: pointer;
    }
    .friends-title {
      font-size: 16px;
      font-weight: 700;
    }
    .friends-add {
      font-family: var(--font-mono);
      font-size: 11px;
      color: var(--dark-green-light);
      cursor: pointer;
    }
    .friends-list {
      padding: 0 20px;
    }
    .friend-row {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      background: var(--dark-surface);
      border-radius: 10px;
      border: 1px solid var(--dark-border);
      margin-bottom: 8px;
      cursor: pointer;
      transition: transform 0.15s;
    }
    .friend-row:active { transform: scale(0.98); }
    .friend-avatar {
      width: 38px; height: 38px;
      border-radius: 50%;
      background: var(--dark-surface-alt);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: 700;
      color: var(--dark-text-primary);
      flex-shrink: 0;
    }
    .friend-info { flex: 1; }
    .friend-name {
      font-size: 13px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .friend-complete-badge {
      font-family: var(--font-mono);
      font-size: 8px;
      background: var(--brand-forest);
      color: white;
      padding: 1px 5px;
      border-radius: 4px;
    }
    .friend-progress-wrap {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 4px;
    }
    .friend-track {
      flex: 1;
      height: 4px;
      background: var(--dark-surface-alt);
      border-radius: 2px;
      overflow: hidden;
    }
    .friend-fill {
      height: 100%;
      background: var(--brand-forest);
      border-radius: 2px;
    }
    .friend-count {
      font-family: var(--font-mono);
      font-size: 10px;
      color: var(--dark-text-secondary);
      flex-shrink: 0;
    }
    .friend-compare-hint {
      font-family: var(--font-mono);
      font-size: 9px;
      color: var(--dark-text-muted);
    }
    .activity-section {
      padding: 0 20px;
    }
    .activity-item {
      display: flex;
      align-items: flex-start;
      gap: 8px;
      padding: 8px 0;
      border-bottom: 1px solid var(--dark-border-subtle);
    }
    .activity-dot {
      width: 6px; height: 6px;
      border-radius: 50%;
      background: var(--dark-green-light);
      margin-top: 5px;
      flex-shrink: 0;
    }
    .activity-text {
      font-size: 12px;
      color: var(--dark-text-primary);
      line-height: 1.4;
    }
    .activity-time {
      font-family: var(--font-mono);
      font-size: 9px;
      color: var(--dark-text-muted);
      display: block;
    }

    /* COMPARISON OVERLAY */
    .compare-overlay {
      position: absolute;
      bottom: 0; left: 0; right: 0;
      background: var(--dark-surface);
      border-radius: 16px 16px 0 0;
      box-shadow: 0 -4px 20px rgba(0,0,0,0.3);
      padding: 16px 20px 24px;
      transform: translateY(100%);
      transition: transform 0.35s ease-out;
      z-index: 60;
      max-height: 70%;
      overflow-y: auto;
    }
    .compare-overlay.visible { transform: translateY(0); }
    .compare-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    .compare-title { font-size: 14px; font-weight: 700; }
    .compare-close {
      width: 28px; height: 28px;
      border-radius: 50%;
      background: var(--dark-surface-alt);
      border: none;
      font-size: 14px;
      color: var(--dark-text-primary);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .compare-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
    }
    .compare-card {
      aspect-ratio: 1;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: var(--font-mono);
      font-size: 9px;
      text-align: center;
      padding: 4px;
    }
    .compare-card.both {
      background: rgba(44,95,45,0.12);
      border: 1.5px solid var(--brand-forest);
      color: var(--brand-forest);
    }
    .compare-card.you-only {
      background: rgba(193,68,14,0.08);
      border: 1.5px solid var(--brand-rust);
      color: var(--brand-rust);
    }
    .compare-card.friend-only {
      background: var(--dark-surface-alt);
      border: 1.5px solid var(--dark-text-muted);
      color: var(--dark-text-muted);
    }
    .compare-card.neither {
      background: var(--dark-surface-alt);
      border: 1.5px dashed var(--dark-text-muted);
      color: var(--dark-text-muted);
    }
    .compare-legend {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
      font-family: var(--font-mono);
      font-size: 9px;
      color: var(--dark-text-secondary);
    }
    .compare-legend-dot {
      display: inline-block;
      width: 8px; height: 8px;
      border-radius: 2px;
      margin-right: 3px;
      vertical-align: middle;
    }

    /* ============================================================
       SCREEN: VIP / #GOGATHER
       ============================================================ */
    .screen[data-screen="vip"] {
      background: #1A1A1A;
      align-items: center;
      padding: 44px 24px 24px;
      gap: 16px;
    }
    .vip-label {
      font-family: var(--font-mono);
      font-size: 10px;
      color: rgba(255,255,255,0.4);
      text-transform: uppercase;
      letter-spacing: 0.12em;
    }
    .vip-pass {
      width: 100%;
      max-width: 300px;
      border-radius: 16px;
      overflow: hidden;
      background: white;
      box-shadow: 0 8px 30px rgba(0,0,0,0.3);
    }
    .vip-pass-header {
      background: var(--brand-forest);
      padding: 14px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .vip-pass-title {
      font-family: var(--font-mono);
      font-size: 13px;
      font-weight: 700;
      color: white;
      letter-spacing: 0.08em;
    }
    .vip-pass-check {
      font-size: 16px;
      color: rgba(255,255,255,0.8);
    }
    .vip-pass-body {
      padding: 20px;
      text-align: center;
    }
    .vip-user-avatar {
      width: 48px; height: 48px;
      border-radius: 50%;
      background: var(--brand-forest);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      font-weight: 700;
      margin: 0 auto 8px;
    }
    .vip-user-name {
      font-size: 16px;
      font-weight: 700;
      display: block;
    }
    .vip-member-id {
      font-family: var(--font-mono);
      font-size: 10px;
      color: var(--wire-stroke-light);
      display: block;
      margin-top: 2px;
    }
    .vip-divider {
      border: none;
      border-top: 1px dashed var(--wire-fill-alt);
      margin: 14px 0;
    }
    .vip-event-name {
      font-family: var(--font-sans);
      font-size: 15px;
      font-weight: 700;
      color: var(--wire-black);
      display: block;
    }
    .vip-event-date {
      font-family: var(--font-mono);
      font-size: 10px;
      color: var(--wire-stroke-light);
      display: block;
      margin-top: 3px;
    }
    .vip-perks {
      list-style: none;
      text-align: left;
      padding: 0 20px;
      width: 100%;
      max-width: 300px;
    }
    .vip-perk {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      padding: 6px 0;
    }
    .vip-perk-icon {
      font-size: 14px;
      flex-shrink: 0;
      margin-top: 1px;
    }
    .vip-perk-text {
      font-size: 12px;
      color: rgba(255,255,255,0.75);
      line-height: 1.4;
    }
    .vip-actions {
      width: 100%;
      max-width: 300px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    /* ============================================================
       SCREEN: ONBOARDING (3 screens)
       ============================================================ */
    .screen[data-screen="onboard-1"],
    .screen[data-screen="onboard-2"],
    .screen[data-screen="onboard-3"] {
      background: var(--dark-bg);
      align-items: center;
      justify-content: center;
      gap: 20px;
      padding: 44px 24px 24px;
    }
    .onboard-hero {
      width: calc(100% + 48px);
      margin: -20px -24px 0;
      height: 260px;
      background: linear-gradient(135deg, #1a2e1a 0%, #2C5F2D 50%, #1a3a1a 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
    }
    .onboard-hero::after {
      content: '';
      position: absolute;
      bottom: 0; left: 0; right: 0;
      height: 80px;
      background: linear-gradient(transparent, var(--dark-bg));
    }
    .onboard-hero-icon {
      font-size: 72px;
      opacity: 0.3;
    }
    .onboard-title {
      font-size: 24px;
      font-weight: 800;
      text-align: center;
      line-height: 1.2;
      color: var(--dark-text-primary);
    }
    .onboard-subtitle {
      font-size: 14px;
      color: var(--dark-text-secondary);
      text-align: center;
      line-height: 1.5;
      max-width: 280px;
    }
    .onboard-dots {
      display: flex;
      gap: 8px;
    }
    .onboard-dot {
      width: 8px; height: 8px;
      border-radius: 50%;
      background: var(--dark-text-muted);
    }
    .onboard-dot.active {
      background: var(--dark-green-light);
      width: 24px;
      border-radius: 4px;
    }
    .onboard-skip {
      font-family: var(--font-mono);
      font-size: 11px;
      color: var(--dark-text-muted);
      cursor: pointer;
      margin-top: 8px;
    }
    .onboard-features {
      display: flex;
      flex-direction: column;
      gap: 12px;
      width: 100%;
    }
    .onboard-feature-card {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 16px;
      background: var(--dark-surface);
      border-radius: 12px;
      border: 1px solid var(--dark-border);
    }
    .onboard-feature-icon {
      width: 40px; height: 40px;
      border-radius: 10px;
      background: var(--dark-green-glow);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      flex-shrink: 0;
    }
    .onboard-feature-title {
      font-size: 14px;
      font-weight: 700;
      display: block;
      color: var(--dark-text-primary);
    }
    .onboard-feature-desc {
      font-size: 12px;
      color: var(--dark-text-secondary);
      line-height: 1.4;
    }

    /* ============================================================
       SCREEN: HOME DASHBOARD
       ============================================================ */
    .screen[data-screen="home"] {
      background: var(--dark-bg);
    }
    .home-greeting {
      padding: 12px 20px 8px;
    }
    .home-welcome {
      font-size: 14px;
      color: var(--dark-text-secondary);
      display: block;
    }
    .home-name {
      font-size: 22px;
      font-weight: 800;
      color: var(--dark-text-primary);
    }
    .home-stats-row {
      display: flex;
      gap: 8px;
      padding: 8px 20px;
    }
    .home-stat-card {
      flex: 1;
      background: var(--dark-surface);
      border: 1px solid var(--dark-border);
      border-radius: 10px;
      padding: 10px;
      text-align: center;
    }
    .home-stat-val {
      font-size: 16px;
      font-weight: 700;
      color: var(--dark-text-primary);
      display: block;
    }
    .home-stat-label {
      font-family: var(--font-mono);
      font-size: 8px;
      color: var(--dark-text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    .home-trail-card {
      margin: 12px 20px;
      padding: 16px;
      background: var(--dark-surface);
      border-radius: 12px;
      border: 1px solid var(--dark-border);
    }
    .home-trail-title {
      font-size: 14px;
      font-weight: 700;
      display: block;
      margin-bottom: 4px;
    }
    .home-trail-pct {
      font-family: var(--font-mono);
      font-size: 11px;
      color: var(--dark-text-secondary);
      display: block;
      margin-bottom: 8px;
    }
    .home-trail-btn {
      margin-top: 10px;
    }
    .home-milestone {
      margin: 0 20px;
      padding: 12px 16px;
      background: var(--dark-surface);
      border-radius: 10px;
      border: 1px solid var(--dark-border);
    }
    .home-milestone-label {
      font-family: var(--font-mono);
      font-size: 10px;
      color: var(--dark-text-secondary);
      display: block;
      margin-bottom: 6px;
    }
    .home-section-label {
      font-family: var(--font-mono);
      font-size: 10px;
      color: var(--dark-text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      padding: 14px 20px 8px;
    }
    .home-activity {
      padding: 0 20px;
    }
    .home-activity-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 0;
      border-bottom: 1px solid var(--dark-border-subtle);
    }
    .home-activity-dot {
      width: 6px; height: 6px;
      border-radius: 50%;
      background: var(--dark-green-light);
      flex-shrink: 0;
    }
    .home-activity-text {
      font-size: 12px;
      color: var(--dark-text-primary);
      flex: 1;
    }
    .home-activity-time {
      font-family: var(--font-mono);
      font-size: 9px;
      color: var(--dark-text-muted);
    }

    /* ============================================================
       SCREEN: GROUPS
       ============================================================ */
    .screen[data-screen="groups"] {
      background: var(--dark-bg);
    }
    .groups-header {
      padding: 12px 20px;
    }
    .groups-title {
      font-size: 18px;
      font-weight: 700;
    }
    .groups-create {
      margin: 0 20px 12px;
      padding: 16px;
      background: var(--dark-green-glow);
      border: 1.5px dashed var(--dark-green-primary);
      border-radius: 12px;
      text-align: center;
      cursor: pointer;
    }
    .groups-create-text {
      font-size: 13px;
      font-weight: 600;
      color: var(--dark-green-light);
    }
    .groups-section-label {
      font-family: var(--font-mono);
      font-size: 10px;
      color: var(--dark-text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      padding: 12px 20px 8px;
    }
    .groups-list {
      padding: 0 20px;
    }
    .group-card {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px;
      background: var(--dark-surface);
      border-radius: 12px;
      border: 1px solid var(--dark-border);
      margin-bottom: 8px;
    }
    .group-avatar {
      width: 42px; height: 42px;
      border-radius: 10px;
      background: var(--dark-green-glow);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      flex-shrink: 0;
    }
    .group-info { flex: 1; }
    .group-name {
      font-size: 14px;
      font-weight: 700;
      display: block;
    }
    .group-members {
      font-family: var(--font-mono);
      font-size: 10px;
      color: var(--dark-text-secondary);
    }
    .group-join-btn {
      font-family: var(--font-mono);
      font-size: 10px;
      font-weight: 700;
      color: var(--dark-green-light);
      background: var(--dark-green-glow);
      border: 1px solid var(--dark-green-primary);
      border-radius: 6px;
      padding: 6px 12px;
      cursor: pointer;
    }

    /* ============================================================
       SCREEN: REWARDS
       ============================================================ */
    .screen[data-screen="rewards"] {
      background: var(--dark-bg);
    }
    .rewards-header {
      padding: 12px 20px;
    }
    .rewards-title {
      font-size: 18px;
      font-weight: 700;
    }
    .rewards-points-card {
      margin: 0 20px 16px;
      padding: 20px;
      background: linear-gradient(135deg, #2C5F2D, #1a3a1a);
      border-radius: 16px;
      text-align: center;
    }
    .rewards-points-label {
      font-family: var(--font-mono);
      font-size: 10px;
      color: rgba(255,255,255,0.5);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      display: block;
    }
    .rewards-points-val {
      font-size: 36px;
      font-weight: 800;
      color: white;
      display: block;
      margin: 4px 0;
    }
    .rewards-points-sub {
      font-family: var(--font-mono);
      font-size: 10px;
      color: rgba(255,255,255,0.4);
    }
    .rewards-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      padding: 0 20px;
    }
    .reward-card {
      background: var(--dark-surface);
      border-radius: 12px;
      border: 1px solid var(--dark-border);
      overflow: hidden;
      cursor: pointer;
      transition: transform 0.15s;
    }
    .reward-card:active { transform: scale(0.97); }
    .reward-img {
      width: 100%;
      aspect-ratio: 4/3;
      background: var(--dark-surface-alt);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
    }
    .reward-info {
      padding: 10px 12px;
    }
    .reward-name {
      font-size: 12px;
      font-weight: 600;
      display: block;
      color: var(--dark-text-primary);
    }
    .reward-pts {
      font-family: var(--font-mono);
      font-size: 10px;
      color: var(--dark-green-light);
      font-weight: 700;
    }

    /* ============================================================
       URBAN GEAR LIBRARY — All Screens
       ============================================================ */

    /* --- Gear Hub (Location Selector) --- */
    .screen[data-screen="gear-hub"] {
      background: var(--dark-bg);
      padding-top: 0 !important;
    }
    .gear-hero {
      position: relative;
      width: 100%;
      height: 200px;
      overflow: hidden;
      background: linear-gradient(135deg, #1a2e1a 0%, #2C5F2D 50%, #1a3a1a 100%);
    }
    .gear-hero-overlay {
      position: absolute;
      inset: 0;
      background: linear-gradient(to bottom, rgba(0,0,0,0.5) 0%, transparent 40%, rgba(26,26,26,0.9) 100%);
      z-index: 1;
    }
    .gear-hero-branding {
      position: absolute;
      top: 52px;
      left: 20px;
      right: 20px;
      z-index: 2;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .gear-hero-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--dark-green-primary);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      color: white;
    }
    .gear-hero-text {
      display: flex;
      flex-direction: column;
    }
    .gear-hero-label {
      font-family: var(--font-sans);
      font-size: 10px;
      font-weight: 700;
      color: rgba(255,255,255,0.85);
      letter-spacing: 0.06em;
    }
    .gear-hero-title {
      font-family: var(--font-sans);
      font-size: 24px;
      font-weight: 900;
      color: white;
      letter-spacing: -0.02em;
      line-height: 1;
    }
    .gear-hero-badge {
      position: absolute;
      bottom: 16px;
      left: 20px;
      z-index: 2;
      display: flex;
      align-items: center;
      gap: 6px;
      background: rgba(255,255,255,0.95);
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 700;
      color: #1A1A1A;
    }
    .gear-hero-badge-dot {
      width: 6px; height: 6px;
      border-radius: 50%;
      background: var(--dark-green-primary);
    }
    .gear-hub-content {
      padding: 20px;
    }
    .gear-hub-heading {
      font-size: 18px;
      font-weight: 900;
      letter-spacing: -0.02em;
      color: var(--dark-text-primary);
      margin-bottom: 4px;
    }
    .gear-hub-sub {
      font-size: 13px;
      color: var(--dark-text-secondary);
      margin-bottom: 16px;
    }
    .gear-location-card {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 14px;
      background: var(--dark-surface);
      border-radius: 16px;
      border: 1px solid var(--dark-border);
      margin-bottom: 10px;
      cursor: pointer;
      transition: transform 0.15s, background 0.15s;
    }
    .gear-location-card:active { transform: scale(0.98); background: var(--dark-surface-alt); }
    .gear-loc-img {
      width: 72px;
      height: 72px;
      border-radius: 12px;
      overflow: hidden;
      position: relative;
      flex-shrink: 0;
      background: var(--dark-surface-alt);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
    }
    .gear-loc-badge {
      position: absolute;
      bottom: 4px;
      left: 4px;
      font-size: 9px;
      font-weight: 800;
      color: white;
      padding: 2px 7px;
      border-radius: 10px;
    }
    .gear-loc-info {
      flex: 1;
      min-width: 0;
    }
    .gear-loc-name {
      font-size: 15px;
      font-weight: 800;
      color: var(--dark-text-primary);
      line-height: 1.2;
      display: block;
    }
    .gear-loc-area {
      font-size: 11px;
      color: var(--dark-text-secondary);
      display: block;
      margin-top: 2px;
    }
    .gear-loc-tags {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 8px;
    }
    .gear-loc-tag {
      font-size: 10px;
      font-weight: 700;
      padding: 3px 8px;
      border-radius: 8px;
      background: var(--dark-surface-alt);
      color: var(--dark-text-secondary);
    }
    .gear-loc-tag.terrain {
      background: rgba(44, 95, 45, 0.15);
      color: var(--dark-green-light);
    }
    .gear-loc-icon-wrap {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      flex-shrink: 0;
    }

    /* --- Gear Location (Bundle Grid) --- */
    .screen[data-screen="gear-tybee"],
    .screen[data-screen="gear-forsyth"],
    .screen[data-screen="gear-daffin"] {
      background: var(--dark-bg);
    }
    .gear-loc-header {
      position: sticky;
      top: 0;
      z-index: 10;
      background: var(--dark-bg);
      border-bottom: 1px solid var(--dark-border-subtle);
      padding: 6px 20px 10px;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .gear-back-btn {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      border: none;
      background: var(--dark-surface);
      color: var(--dark-text-primary);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 16px;
      transition: background 0.15s;
    }
    .gear-back-btn:active { background: var(--dark-surface-alt); }
    .gear-loc-header-info {
      flex: 1;
    }
    .gear-loc-header-tag {
      font-size: 10px;
      font-weight: 700;
      letter-spacing: 0.04em;
      display: flex;
      align-items: center;
      gap: 5px;
      margin-bottom: 1px;
    }
    .gear-loc-header-tag .dot {
      width: 6px; height: 6px;
      border-radius: 50%;
      display: inline-block;
    }
    .gear-loc-header-title {
      font-size: 18px;
      font-weight: 900;
      letter-spacing: -0.02em;
      color: var(--dark-text-primary);
    }
    .gear-loc-header-city {
      font-size: 11px;
      font-weight: 700;
      padding: 4px 10px;
      border-radius: 12px;
      background: var(--dark-surface);
      color: var(--dark-text-secondary);
      display: flex;
      align-items: center;
      gap: 4px;
    }
    .gear-bundle-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      padding: 14px 14px 100px;
    }
    .gear-bundle-card {
      background: var(--dark-surface);
      border-radius: 14px;
      overflow: hidden;
      border: 1px solid var(--dark-border);
      cursor: pointer;
      transition: transform 0.15s;
    }
    .gear-bundle-card:active { transform: scale(0.97); }
    .gear-bundle-img {
      width: 100%;
      height: 100px;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 36px;
      background: var(--dark-surface-alt);
      overflow: hidden;
    }
    .gear-bundle-img::after {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(to top, rgba(0,0,0,0.5) 0%, transparent 60%);
    }
    .gear-bundle-proximity {
      position: absolute;
      top: 6px;
      right: 6px;
      font-size: 9px;
      font-weight: 800;
      color: white;
      padding: 3px 8px;
      border-radius: 10px;
      z-index: 2;
    }
    .gear-bundle-price-tag {
      position: absolute;
      bottom: 6px;
      left: 6px;
      font-size: 11px;
      font-weight: 800;
      color: #1A1A1A;
      background: rgba(255,255,255,0.92);
      padding: 2px 8px;
      border-radius: 10px;
      z-index: 2;
    }
    .gear-bundle-body {
      padding: 10px 10px 12px;
    }
    .gear-bundle-name {
      font-size: 12px;
      font-weight: 800;
      color: var(--dark-text-primary);
      line-height: 1.2;
      margin-bottom: 6px;
    }
    .gear-item-row {
      display: flex;
      align-items: center;
      gap: 5px;
      margin-bottom: 3px;
    }
    .gear-item-icon {
      width: 14px;
      height: 14px;
      border-radius: 3px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 8px;
      flex-shrink: 0;
    }
    .gear-item-text {
      font-size: 10px;
      color: var(--dark-text-secondary);
    }
    .gear-bundle-duration {
      margin-top: 8px;
      text-align: center;
      padding: 5px;
      border-radius: 8px;
      background: var(--dark-surface-alt);
      font-size: 10px;
      font-weight: 700;
      color: var(--dark-text-secondary);
    }

    /* --- Gear Smart Map (bottom bar) --- */
    .gear-map-footer {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--dark-surface);
      border-top: 1px solid var(--dark-border);
      padding: 14px 20px;
      z-index: 20;
    }
    .gear-map-heading {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
    }
    .gear-map-heading-left {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      font-weight: 800;
      color: var(--dark-text-primary);
      text-transform: uppercase;
    }
    .gear-map-terrain {
      font-size: 10px;
      color: var(--dark-text-muted);
    }
    .gear-map-visual {
      width: 100%;
      height: 80px;
      border-radius: 10px;
      position: relative;
      overflow: hidden;
      margin-bottom: 8px;
    }
    .gear-map-pin {
      position: absolute;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      color: white;
      z-index: 2;
    }
    .gear-map-pin::after {
      content: '';
      position: absolute;
      inset: -4px;
      border-radius: 50%;
      animation: gear-pin-pulse 2s ease-in-out infinite;
    }
    @keyframes gear-pin-pulse {
      0%, 100% { transform: scale(1); opacity: 0.4; }
      50% { transform: scale(1.4); opacity: 0; }
    }
    .gear-locker-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 6px 10px;
      border-radius: 8px;
      background: var(--dark-surface-alt);
      margin-bottom: 4px;
    }
    .gear-locker-row-left {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      font-weight: 600;
      color: var(--dark-text-primary);
    }
    .gear-locker-dot {
      width: 6px; height: 6px;
      border-radius: 50%;
    }
    .gear-locker-dist {
      font-size: 10px;
      font-weight: 700;
      color: white;
      padding: 2px 8px;
      border-radius: 10px;
    }

    /* --- Gear Verification --- */
    .screen[data-screen="gear-verify"] {
      background: var(--dark-bg);
    }
    .gear-verify-header {
      position: sticky;
      top: 0;
      z-index: 10;
      background: var(--dark-bg);
      border-bottom: 1px solid var(--dark-border-subtle);
      padding: 6px 20px 0;
    }
    .gear-verify-top {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 10px;
    }
    .gear-verify-progress {
      display: flex;
      gap: 6px;
      padding-bottom: 12px;
    }
    .gear-verify-bar {
      flex: 1;
      height: 4px;
      border-radius: 2px;
      background: var(--dark-surface-alt);
      overflow: hidden;
    }
    .gear-verify-bar-fill {
      height: 100%;
      background: var(--dark-green-primary);
      width: 0%;
      transition: width 0.4s ease;
    }
    .gear-verify-bar.done .gear-verify-bar-fill { width: 100%; }
    .gear-verify-steps {
      display: flex;
      justify-content: space-between;
      padding: 16px 20px;
    }
    .gear-verify-step {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
    }
    .gear-verify-step-circle {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      transition: all 0.3s;
      background: var(--dark-surface);
      color: var(--dark-text-muted);
    }
    .gear-verify-step-circle.active {
      background: rgba(44,95,45,0.2);
      color: var(--dark-green-light);
      box-shadow: 0 0 0 2px var(--dark-green-primary);
    }
    .gear-verify-step-circle.done {
      background: var(--dark-green-primary);
      color: white;
    }
    .gear-verify-step-label {
      font-size: 10px;
      font-weight: 600;
      color: var(--dark-text-secondary);
      text-align: center;
    }
    .gear-verify-content {
      flex: 1;
      padding: 0 20px;
    }
    .gear-verify-card {
      background: var(--dark-surface);
      border-radius: 16px;
      border: 1px solid var(--dark-border);
      padding: 20px;
      margin-bottom: 14px;
    }
    .gear-verify-card-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 14px;
    }
    .gear-verify-card-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: rgba(44,95,45,0.15);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      color: var(--dark-green-light);
    }
    .gear-verify-card-title {
      font-size: 14px;
      font-weight: 800;
      color: var(--dark-text-primary);
      display: block;
    }
    .gear-verify-card-sub {
      font-size: 11px;
      color: var(--dark-text-secondary);
    }
    .gear-phone-input {
      width: 100%;
      padding: 14px;
      background: var(--dark-surface-alt);
      border: 1px solid var(--dark-border);
      border-radius: 12px;
      color: var(--dark-text-primary);
      font-family: var(--font-sans);
      font-size: 16px;
      font-weight: 600;
      outline: none;
      transition: border-color 0.2s;
    }
    .gear-phone-input:focus {
      border-color: var(--dark-green-primary);
      box-shadow: 0 0 0 2px var(--dark-green-glow);
    }
    .gear-phone-input::placeholder {
      color: var(--dark-text-muted);
    }
    .gear-scan-zone {
      width: 100%;
      min-height: 160px;
      border: 2px dashed var(--dark-border);
      border-radius: 16px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 10px;
      background: rgba(255,255,255,0.02);
      transition: all 0.3s;
    }
    .gear-scan-zone.verified {
      border-color: var(--dark-green-primary);
      background: rgba(44,95,45,0.08);
    }
    .gear-scan-zone .scan-icon {
      font-size: 40px;
      color: var(--dark-text-muted);
    }
    .gear-scan-zone.verified .scan-icon {
      color: var(--dark-green-light);
    }
    .gear-scan-btn {
      font-family: var(--font-sans);
      font-size: 13px;
      font-weight: 700;
      padding: 10px 20px;
      border-radius: 12px;
      border: none;
      background: var(--dark-green-primary);
      color: white;
      cursor: pointer;
    }
    .gear-scan-btn:active { transform: scale(0.97); }
    .gear-verify-info {
      display: flex;
      gap: 10px;
      padding: 14px;
      background: var(--dark-surface-alt);
      border-radius: 12px;
    }
    .gear-verify-info-icon {
      font-size: 16px;
      color: var(--dark-green-light);
      flex-shrink: 0;
      margin-top: 1px;
    }
    .gear-verify-info-text {
      font-size: 12px;
      color: var(--dark-text-secondary);
      line-height: 1.5;
    }
    .gear-payment-rows {
      margin-top: 14px;
      text-align: center;
    }
    .gear-payment-row {
      display: flex;
      justify-content: space-between;
      padding: 4px 16px;
      font-size: 12px;
    }
    .gear-payment-row .label { color: var(--dark-text-secondary); }
    .gear-payment-row .value { font-weight: 700; color: var(--dark-text-primary); }
    .gear-payment-divider {
      border: none;
      border-top: 1px solid var(--dark-border-subtle);
      margin: 6px 16px;
    }
    .gear-payment-note {
      font-size: 10px;
      color: var(--dark-text-muted);
      text-align: center;
      margin-top: 6px;
    }
    .gear-verify-cta {
      padding: 16px 20px 24px;
    }
    .gear-verify-cta .demo-btn {
      transition: background 0.2s, color 0.2s;
    }
    .gear-verify-cta .demo-btn.disabled {
      background: var(--dark-surface-alt);
      color: var(--dark-text-muted);
      cursor: not-allowed;
    }

    /* --- Gear Unlock --- */
    .screen[data-screen="gear-unlock"] {
      background: var(--dark-bg);
    }
    .gear-unlock-header {
      padding: 10px 20px 0;
    }
    .gear-unlock-badge {
      display: inline-block;
      background: var(--dark-green-primary);
      color: white;
      padding: 4px 14px;
      border-radius: 14px;
      font-size: 10px;
      font-weight: 700;
      letter-spacing: 0.04em;
      margin-bottom: 10px;
    }
    .gear-unlock-title {
      font-size: 26px;
      font-weight: 900;
      color: var(--dark-text-primary);
      letter-spacing: -0.02em;
    }
    .gear-unlock-subtitle {
      font-size: 14px;
      color: var(--dark-text-secondary);
      margin-top: 2px;
    }
    .gear-unlock-info {
      margin: 16px 20px;
      background: var(--dark-surface);
      border-radius: 20px;
      border: 1px solid var(--dark-border);
      padding: 18px;
    }
    .gear-unlock-info-top {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 14px;
    }
    .gear-unlock-bundle-name {
      font-size: 18px;
      font-weight: 800;
      color: var(--dark-text-primary);
    }
    .gear-unlock-bundle-tag {
      font-size: 11px;
      color: var(--dark-text-secondary);
    }
    .gear-unlock-bundle-price {
      font-size: 14px;
      font-weight: 700;
      color: var(--dark-green-light);
      background: rgba(44,95,45,0.15);
      padding: 3px 10px;
      border-radius: 10px;
    }
    .gear-unlock-detail-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }
    .gear-unlock-detail-icon {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background: rgba(44,95,45,0.15);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      color: var(--dark-green-light);
      flex-shrink: 0;
    }
    .gear-unlock-detail-label {
      font-size: 11px;
      color: var(--dark-text-muted);
      display: block;
    }
    .gear-unlock-detail-value {
      font-size: 13px;
      font-weight: 600;
      color: var(--dark-text-primary);
    }
    .gear-unlock-items-section {
      border-top: 1px solid var(--dark-border-subtle);
      padding-top: 12px;
      margin-top: 4px;
    }
    .gear-unlock-items-label {
      font-size: 11px;
      color: var(--dark-text-muted);
      margin-bottom: 6px;
      display: block;
    }
    .gear-unlock-items-list {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }
    .gear-unlock-item-chip {
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 8px;
      background: var(--dark-surface-alt);
      color: var(--dark-text-secondary);
    }
    .gear-countdown {
      margin: 0 20px 14px;
      background: var(--dark-surface-alt);
      border-radius: 14px;
      padding: 16px;
      text-align: center;
    }
    .gear-countdown-label {
      font-size: 11px;
      color: var(--dark-text-muted);
      display: block;
      margin-bottom: 4px;
    }
    .gear-countdown-time {
      font-size: 36px;
      font-weight: 900;
      color: var(--dark-green-light);
      letter-spacing: -0.02em;
    }

    /* Slide to Unlock */
    .gear-slider-wrap {
      padding: 0 20px;
    }
    .gear-slider-track {
      position: relative;
      height: 64px;
      border-radius: 20px;
      background: var(--dark-green-primary);
      overflow: hidden;
      box-shadow: 0 4px 20px rgba(44,95,45,0.3);
      touch-action: none;
    }
    .gear-slider-label {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 15px;
      font-weight: 800;
      color: white;
      letter-spacing: 0.04em;
      pointer-events: none;
      transition: opacity 0.3s;
    }
    .gear-slider-thumb {
      position: absolute;
      left: 6px;
      top: 6px;
      bottom: 6px;
      width: 52px;
      background: white;
      border-radius: 16px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      color: var(--dark-green-primary);
      cursor: grab;
      touch-action: none;
      transition: left 0.1s;
      z-index: 2;
      user-select: none;
    }
    .gear-slider-thumb:active { cursor: grabbing; }
    .gear-slider-hint {
      text-align: center;
      font-size: 12px;
      color: var(--dark-text-muted);
      margin-top: 12px;
    }

    /* Unlock Success State */
    .gear-success-card {
      margin: 0 20px 14px;
      background: var(--dark-green-primary);
      border-radius: 20px;
      padding: 28px;
      text-align: center;
      color: white;
    }
    .gear-success-icon {
      width: 64px;
      height: 64px;
      border-radius: 50%;
      background: rgba(255,255,255,0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      margin: 0 auto 12px;
    }
    .gear-success-title {
      font-size: 22px;
      font-weight: 900;
      letter-spacing: -0.01em;
    }
    .gear-success-text {
      font-size: 14px;
      color: rgba(255,255,255,0.85);
      margin-top: 6px;
    }
    .gear-unlock-actions {
      padding: 0 20px;
    }
    .gear-return-note {
      background: var(--dark-surface-alt);
      border-radius: 14px;
      padding: 12px;
      text-align: center;
      font-size: 12px;
      color: var(--dark-text-secondary);
      margin-top: 10px;
    }

    /* Lock overlay animation */
    .gear-lock-overlay {
      position: absolute;
      top: 30%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 80px;
      pointer-events: none;
      opacity: 0.06;
      color: var(--dark-green-light);
      animation: gear-lock-breathe 2s ease-in-out infinite;
    }
    @keyframes gear-lock-breathe {
      0%, 100% { opacity: 0.04; }
      50% { opacity: 0.08; }
    }

    /* ============================================================
       RESPONSIVE: MOBILE (fills viewport)
       ============================================================ */
    @media (max-width: 480px) {
      body { justify-content: flex-start; }
      .demo-wrapper { padding: 0; width: 100%; }
      .demo-narrator { display: none; }
      .demo-phone {
        width: 100%;
        height: 100vh;
        height: 100dvh;
        border: none;
        border-radius: 0;
        box-shadow: none;
      }
      .demo-notch, .demo-home-bar { display: none; }
      .demo-dots { display: none; }
    }
  </style>
</head>
<body>

<div class="demo-wrapper">

  <!-- NARRATOR -->
  <div class="demo-narrator" id="narrator">
    <div class="narrator-dot"></div>
    <span class="narrator-text" id="narratorText">The app introduces the Outdoor Walking Experience — discover hidden checkpoints across the city.</span>
    <button class="narrator-toggle" onclick="toggleNarrator()">Hide</button>
  </div>

  <!-- PHONE FRAME -->
  <div class="demo-phone">
    <div class="demo-notch"></div>
    <div class="demo-home-bar"></div>
    <div class="demo-screen-area">

      <!-- Status Bar (shared) -->
      <div class="status-bar light" id="statusBar">
        <span>9:41</span>
        <span style="font-size:10px;">&#9679;&#9679;&#9679;</span>
      </div>

      <!-- ===== SCREEN: ONBOARDING 1 ===== -->
      <section class="screen active" data-screen="onboard-1">
        <div class="onboard-hero">
          <span class="onboard-hero-icon">&#127795;</span>
        </div>
        <h1 class="onboard-title">Find the Trail<br>Within the City</h1>
        <p class="onboard-subtitle">Discover hidden checkpoints, collect documentary photo prints, and explore Savannah like never before.</p>
        <div class="onboard-dots">
          <span class="onboard-dot active"></span>
          <span class="onboard-dot"></span>
          <span class="onboard-dot"></span>
        </div>
        <button class="demo-btn primary" onclick="go('onboard-2')">Start the Trail</button>
        <span class="onboard-skip" onclick="go('vending')">Skip</span>
      </section>

      <!-- ===== SCREEN: ONBOARDING 2 ===== -->
      <section class="screen" data-screen="onboard-2">
        <h2 class="onboard-title" style="font-size:20px;">How It Works</h2>
        <div class="onboard-features">
          <div class="onboard-feature-card">
            <div class="onboard-feature-icon">&#128205;</div>
            <div>
              <span class="onboard-feature-title">Explore</span>
              <span class="onboard-feature-desc">Walk the Savannah City Trail and find vending machines at 8 checkpoints.</span>
            </div>
          </div>
          <div class="onboard-feature-card">
            <div class="onboard-feature-icon">&#128244;</div>
            <div>
              <span class="onboard-feature-title">Tap NFC</span>
              <span class="onboard-feature-desc">Buy a $3 documentary photo print and scan the QR code on the back.</span>
            </div>
          </div>
          <div class="onboard-feature-card">
            <div class="onboard-feature-icon">&#127942;</div>
            <div>
              <span class="onboard-feature-title">Unlock</span>
              <span class="onboard-feature-desc">Collect digital cards, earn points, and unlock exclusive L.L.Bean rewards.</span>
            </div>
          </div>
        </div>
        <div class="onboard-dots">
          <span class="onboard-dot"></span>
          <span class="onboard-dot active"></span>
          <span class="onboard-dot"></span>
        </div>
        <button class="demo-btn primary" onclick="go('onboard-3')">Continue</button>
        <span class="onboard-skip" onclick="go('vending')">Skip</span>
      </section>

      <!-- ===== SCREEN: ONBOARDING 3 ===== -->
      <section class="screen" data-screen="onboard-3">
        <div class="onboard-hero" style="height:200px;background:linear-gradient(135deg, #1a2a1a 0%, #2C5F2D 60%, #1a3a1a 100%);">
          <span class="onboard-hero-icon">&#129309;</span>
        </div>
        <h2 class="onboard-title" style="font-size:20px;">Walk Together</h2>
        <div class="onboard-features">
          <div class="onboard-feature-card">
            <div class="onboard-feature-icon">&#128101;</div>
            <div>
              <span class="onboard-feature-title">Groups</span>
              <span class="onboard-feature-desc">Join walking groups and explore the trail with friends.</span>
            </div>
          </div>
          <div class="onboard-feature-card">
            <div class="onboard-feature-icon">&#127942;</div>
            <div>
              <span class="onboard-feature-title">Leaderboards</span>
              <span class="onboard-feature-desc">Compete for top collector and earn bragging rights.</span>
            </div>
          </div>
        </div>
        <div class="onboard-dots">
          <span class="onboard-dot"></span>
          <span class="onboard-dot"></span>
          <span class="onboard-dot active"></span>
        </div>
        <button class="demo-btn primary" onclick="go('vending')">Find Friends</button>
        <span class="onboard-skip" onclick="go('vending')">Skip</span>
      </section>

      <!-- ===== SCREEN 1: VENDING ===== -->
      <section class="screen" data-screen="vending">
        <div class="vending-header">
          <span class="vending-wordmark">L.L.Bean</span>
          <span class="vending-headline">FIELD NOTES</span>
        </div>
        <div class="vending-badge">CP3: THE PARK</div>
        <div class="vending-photo" style="background-image: url('images/03-park.png');"></div>
        <div class="vending-meta">
          <span>38 of 50 remaining</span>
          <span class="vending-price">$3</span>
        </div>
        <div class="vending-actions">
          <button class="demo-btn primary" onclick="go('print')">Select This Print</button>
        </div>
        <div class="vending-pay">
          <span class="vending-nfc">)))</span> Tap to pay &mdash; Apple Pay, Google Pay
        </div>
      </section>

      <!-- ===== SCREEN 2/3: PRINT (3D flip) ===== -->
      <section class="screen" data-screen="print">
        <div style="flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:20px;padding:0 24px;">
          <div class="print-scene">
            <div class="print-card-3d print-dispensing" id="printCard" onclick="flipPrint()">
              <!-- FRONT -->
              <div class="print-face print-face-front">
                <div class="print-photo-area" style="background-image: url('images/03-park.png');"></div>
                <div class="print-info-bar">
                  <span class="print-cp">CP3: THE PARK</span>
                  <span class="print-ed">12 / 50</span>
                </div>
              </div>
              <!-- BACK -->
              <div class="print-face print-face-back">
                <div class="qr-visual" onclick="event.stopPropagation(); go('scan');">
                  <div class="qr-cell"></div><div class="qr-cell empty"></div><div class="qr-cell"></div><div class="qr-cell empty"></div><div class="qr-cell"></div>
                  <div class="qr-cell empty"></div><div class="qr-cell"></div><div class="qr-cell empty"></div><div class="qr-cell"></div><div class="qr-cell empty"></div>
                  <div class="qr-cell"></div><div class="qr-cell empty"></div><div class="qr-cell"></div><div class="qr-cell empty"></div><div class="qr-cell"></div>
                  <div class="qr-cell empty"></div><div class="qr-cell"></div><div class="qr-cell empty"></div><div class="qr-cell"></div><div class="qr-cell empty"></div>
                  <div class="qr-cell"></div><div class="qr-cell empty"></div><div class="qr-cell"></div><div class="qr-cell empty"></div><div class="qr-cell"></div>
                </div>
                <p class="print-caption">&ldquo;Every corner has a story&rdquo;</p>
                <p class="print-scan-cta">Scan to activate your digital collectible</p>
                <div class="print-brand">
                  <span class="print-brand-fn">FIELD NOTES</span>
                  <span class="print-brand-ll">L.L.Bean</span>
                </div>
              </div>
            </div>
          </div>
          <p class="print-instruction" id="printInstruction">Your print has been dispensed. Tap to flip it over.</p>
        </div>
      </section>

      <!-- ===== SCREEN 4: SCAN ===== -->
      <section class="screen" data-screen="scan">
        <div class="scan-viewfinder">
          <div class="scan-reticle" id="scanReticle">
            <div class="scan-corner tl"></div>
            <div class="scan-corner tr"></div>
            <div class="scan-corner bl"></div>
            <div class="scan-corner br"></div>
            <div class="scan-line"></div>
          </div>
          <span class="scan-instruction">Point camera at QR code</span>
        </div>
      </section>

      <!-- ===== SCREEN 5: LOADING ===== -->
      <section class="screen" data-screen="loading">
        <div class="compass-spinner">
          <svg viewBox="0 0 56 56" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="28" cy="28" r="26" stroke="#3A7D3C" stroke-width="1.5" opacity="0.3"/>
            <path d="M28 2 L31 28 L28 54 L25 28 Z" fill="#3A7D3C" opacity="0.6"/>
            <path d="M2 28 L28 25 L54 28 L28 31 Z" fill="#8B8680" opacity="0.4"/>
            <circle cx="28" cy="28" r="3" fill="#3A7D3C"/>
          </svg>
        </div>
        <p class="loading-text">Activating your<br>Field Note...</p>
        <div class="loading-bar">
          <div class="loading-bar-fill" id="loadingFill"></div>
        </div>
      </section>

      <!-- ===== SCREEN 6: REVEAL ===== -->
      <section class="screen" data-screen="reveal">
        <div style="flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:20px;padding:0 24px;">
          <div class="reveal-scene">
            <div class="reveal-card" id="revealCard">
              <div class="reveal-face reveal-back-face">
                <span class="reveal-back-fn">FIELD NOTES</span>
                <span class="reveal-back-ll">L.L.Bean</span>
              </div>
              <div class="reveal-face reveal-front-face">
                <div class="reveal-photo" style="background-image: url('images/03-park.png');"></div>
                <div class="reveal-info">
                  <span class="reveal-name">THE PARK</span>
                  <span class="reveal-edition">Edition 12 / 50</span>
                  <span class="reveal-date">January 15, 2026</span>
                </div>
              </div>
            </div>
          </div>
          <p class="reveal-caption">&ldquo;Every corner has a story&rdquo;</p>
          <div class="reveal-btn-wrap" id="revealBtnWrap">
            <button class="demo-btn primary" onclick="go('confirm')">Continue</button>
          </div>
        </div>
      </section>

      <!-- ===== SCREEN 7: CONFIRM ===== -->
      <section class="screen" data-screen="confirm">
        <div class="confirm-check">
          <svg viewBox="0 0 24 24"><path d="M4 12 L9 17 L20 6"/></svg>
        </div>
        <h2 class="confirm-title">Added to your<br>Field Notes</h2>
        <span class="confirm-count">4 of 8 collected</span>
        <div class="confirm-progress">
          <div class="progress-track">
            <div class="progress-fill" id="confirmProgress" style="width: 37.5%;"></div>
          </div>
        </div>
        <div class="confirm-actions">
          <button class="demo-btn secondary small">Share</button>
          <button class="demo-btn primary small" onclick="go('home')">View Dashboard</button>
        </div>
      </section>

      <!-- ===== SCREEN 8: GALLERY ===== -->
      <section class="screen" data-screen="gallery">
        <div class="gallery-header">
          <h2 class="gallery-title">My Field Notes</h2>
          <span class="gallery-share">Share All</span>
        </div>
        <div class="gallery-progress">
          <span class="gallery-progress-label" id="galleryProgressLabel">4 of 8 locations discovered</span>
          <div class="progress-track">
            <div class="progress-fill" id="galleryProgressFill" style="width: 50%;"></div>
          </div>
        </div>
        <div class="gallery-grid" id="galleryGrid"></div>
        <div class="gallery-community">
          <span>487 collectors active</span>
          <span class="gallery-map-link" onclick="go('map')">View map &rarr;</span>
        </div>
        <div class="gallery-fast-forward">
          <button class="demo-btn ghost" id="fastForwardBtn" onclick="fastForward()">Complete Collection &rarr;</button>
        </div>
        <div class="tab-bar" id="tabBarGallery"></div>
      </section>

      <!-- ===== SCREEN 9: DETAIL ===== -->
      <section class="screen" data-screen="detail">
        <div class="detail-nav">
          <span class="detail-back" onclick="go('gallery','left')">&larr; Back</span>
          <span class="detail-share">Share</span>
        </div>
        <div class="detail-photo" id="detailPhoto"></div>
        <div class="detail-meta">
          <span class="detail-location" id="detailLocation"></span>
          <span class="detail-date" id="detailDate"></span>
          <span class="detail-edition" id="detailEdition"></span>
        </div>
        <blockquote class="detail-story" id="detailStory"></blockquote>
        <div class="detail-video">
          <div class="detail-play">&#9654;</div>
          <div class="detail-video-text">
            <strong>Watch the moment</strong>
            <span>Documentary footage &mdash; 0:45</span>
          </div>
        </div>
        <div class="detail-actions">
          <button class="demo-btn primary">Share to Instagram Stories</button>
        </div>
      </section>

      <!-- ===== SCREEN 10: MAP ===== -->
      <section class="screen" data-screen="map">
        <div class="map-header">
          <h2 class="map-title">Savannah Trail</h2>
        </div>
        <div class="map-container">
          <svg viewBox="0 0 200 300" xmlns="http://www.w3.org/2000/svg" id="mapSvg">
            <rect width="200" height="300" fill="#1A1A1A"/>
            <path d="M0 28 Q40 22, 80 30 Q120 38, 160 26 Q180 22, 200 25" fill="none" stroke="#2A4A5A" stroke-width="8" opacity="0.6"/>
            <path d="M0 28 Q40 22, 80 30 Q120 38, 160 26 Q180 22, 200 25 L200 0 L0 0 Z" fill="#1E3040" opacity="0.5"/>
            <text x="100" y="16" text-anchor="middle" font-family="Georgia,serif" font-size="6" fill="#4A7080" font-style="italic">Savannah River</text>
            <line x1="55" y1="18" x2="55" y2="45" stroke="rgba(255,255,255,0.15)" stroke-width="2.5" stroke-linecap="round"/>
            <line x1="8" y1="75" x2="192" y2="75" stroke="rgba(255,255,255,0.08)" stroke-width="0.8"/>
            <text x="6" y="73" font-family="monospace" font-size="5" fill="rgba(255,255,255,0.25)">Bay St</text>
            <line x1="8" y1="105" x2="192" y2="105" stroke="rgba(255,255,255,0.08)" stroke-width="0.8"/>
            <text x="6" y="103" font-family="monospace" font-size="5" fill="rgba(255,255,255,0.25)">Broughton</text>
            <line x1="8" y1="145" x2="192" y2="145" stroke="rgba(255,255,255,0.08)" stroke-width="0.8"/>
            <text x="6" y="143" font-family="monospace" font-size="5" fill="rgba(255,255,255,0.25)">Perry</text>
            <line x1="8" y1="168" x2="192" y2="168" stroke="rgba(255,255,255,0.08)" stroke-width="0.8"/>
            <text x="6" y="166" font-family="monospace" font-size="5" fill="rgba(255,255,255,0.25)">Jones</text>
            <line x1="8" y1="195" x2="192" y2="195" stroke="rgba(255,255,255,0.08)" stroke-width="0.8"/>
            <text x="6" y="193" font-family="monospace" font-size="5" fill="rgba(255,255,255,0.25)">Gaston</text>
            <line x1="55" y1="45" x2="55" y2="280" stroke="rgba(255,255,255,0.08)" stroke-width="0.8"/>
            <text x="53" y="288" text-anchor="middle" font-family="monospace" font-size="5" fill="rgba(255,255,255,0.25)">Bull</text>
            <line x1="90" y1="45" x2="90" y2="280" stroke="rgba(255,255,255,0.08)" stroke-width="0.8"/>
            <text x="88" y="288" text-anchor="middle" font-family="monospace" font-size="5" fill="rgba(255,255,255,0.25)">Drayton</text>
            <line x1="125" y1="45" x2="125" y2="280" stroke="rgba(255,255,255,0.08)" stroke-width="0.8"/>
            <text x="123" y="288" text-anchor="middle" font-family="monospace" font-size="5" fill="rgba(255,255,255,0.25)">Abercorn</text>
            <line x1="160" y1="45" x2="160" y2="280" stroke="rgba(255,255,255,0.08)" stroke-width="0.8"/>
            <rect x="35" y="210" width="65" height="55" rx="3" fill="#2C5F2D" opacity="0.15" stroke="#2C5F2D" stroke-width="0.5" stroke-opacity="0.3"/>
            <text x="67" y="240" text-anchor="middle" font-family="monospace" font-size="5.5" fill="#3A7D3C" opacity="0.6">Forsyth Park</text>
            <!-- Pins rendered by JS -->
            <g id="mapPins"></g>
          </svg>
        </div>
        <div class="map-legend">
          <span><span class="map-dot collected"></span> Collected</span>
          <span><span class="map-dot locked"></span> Undiscovered</span>
        </div>
        <div class="map-continue">
          <button class="demo-btn ghost" onclick="go('groups')">Continue Demo &rarr;</button>
        </div>
        <div class="tab-bar" id="tabBarMap"></div>
      </section>

      <!-- ===== SCREEN: PROFILE ===== -->
      <section class="screen" data-screen="profile">
        <div class="profile-header">
          <div class="profile-avatar">KH</div>
          <div>
            <span class="profile-name">Kim Harper</span>
            <span class="profile-handle">@kimtharper</span>
          </div>
        </div>
        <div class="profile-stats">
          <div class="profile-stat">
            <span class="profile-stat-num" id="profileCollected">4/8</span>
            <span class="profile-stat-label">Collected</span>
          </div>
          <div class="profile-stat">
            <span class="profile-stat-num">2</span>
            <span class="profile-stat-label">Rare</span>
          </div>
          <div class="profile-stat">
            <span class="profile-stat-num">#5</span>
            <span class="profile-stat-label">Rank</span>
          </div>
        </div>
        <div class="profile-section-label">Achievements</div>
        <div class="badge-grid" id="badgeGrid"></div>
        <div class="profile-section-label">Collection Breakdown</div>
        <div class="profile-breakdown">
          <div class="breakdown-row">
            <span class="breakdown-label">Standard</span>
            <div class="breakdown-track">
              <div class="breakdown-fill" id="breakdownStandard" style="width:50%;background:var(--brand-forest);"></div>
            </div>
            <span class="breakdown-count" id="breakdownStdCount">4/8</span>
          </div>
          <div class="breakdown-row">
            <span class="breakdown-label">Rare</span>
            <div class="breakdown-track">
              <div class="breakdown-fill" style="width:20%;background:var(--brand-ochre);"></div>
            </div>
            <span class="breakdown-count">2/10</span>
          </div>
        </div>
        <div class="profile-actions">
          <button class="demo-btn secondary small" onclick="go('leaderboard')">Leaderboard</button>
          <button class="demo-btn secondary small" onclick="go('friends')">Friends (4)</button>
        </div>
        <div class="tab-bar" id="tabBarProfile"></div>
      </section>

      <!-- ===== SCREEN: HOME DASHBOARD ===== -->
      <section class="screen" data-screen="home">
        <div class="home-greeting">
          <span class="home-welcome">Welcome back,</span>
          <span class="home-name">Kim Harper</span>
        </div>
        <div class="home-stats-row">
          <div class="home-stat-card">
            <span class="home-stat-val">2.4 mi</span>
            <span class="home-stat-label">Distance</span>
          </div>
          <div class="home-stat-card">
            <span class="home-stat-val" id="homeTrailPct">50%</span>
            <span class="home-stat-label">Trail</span>
          </div>
          <div class="home-stat-card">
            <span class="home-stat-val">2,450</span>
            <span class="home-stat-label">Points</span>
          </div>
        </div>
        <div class="home-trail-card">
          <span class="home-trail-title">Savannah City Trail</span>
          <span class="home-trail-pct" id="homeTrailLabel">4 of 8 collected</span>
          <div class="progress-track">
            <div class="progress-fill" id="homeTrailFill" style="width:50%;"></div>
          </div>
          <div class="home-trail-btn">
            <button class="demo-btn primary small" onclick="go('gallery')">View Collection</button>
          </div>
        </div>
        <div class="home-milestone">
          <span class="home-milestone-label">Milestone Progress</span>
          <div class="progress-track">
            <div class="progress-fill" style="width:45%;"></div>
          </div>
        </div>
        <!-- Gear Library Quick Access -->
        <div onclick="go('gear-hub')" style="margin:0 20px 14px;padding:14px 16px;background:linear-gradient(135deg,rgba(44,95,45,0.2),rgba(44,95,45,0.08));border:1px solid var(--dark-border);border-radius:14px;cursor:pointer;display:flex;align-items:center;gap:12px;transition:transform 0.15s;" onmousedown="this.style.transform='scale(0.98)'" onmouseup="this.style.transform=''">
          <div style="width:40px;height:40px;border-radius:10px;background:var(--dark-green-primary);display:flex;align-items:center;justify-content:center;font-size:18px;">&#128205;</div>
          <div style="flex:1;">
            <div style="font-size:13px;font-weight:800;color:var(--dark-text-primary);">Urban Gear Library</div>
            <div style="font-size:11px;color:var(--dark-text-secondary);">Rent outdoor gear at Savannah&rsquo;s parks</div>
          </div>
          <span style="font-size:18px;color:var(--dark-text-muted);">&#8250;</span>
        </div>
        <span class="home-section-label">Recent Activity</span>
        <div class="home-activity">
          <div class="home-activity-item">
            <div class="home-activity-dot"></div>
            <span class="home-activity-text">You collected The Park</span>
            <span class="home-activity-time">Just now</span>
          </div>
          <div class="home-activity-item">
            <div class="home-activity-dot"></div>
            <span class="home-activity-text">Sarah M. found The Bridge</span>
            <span class="home-activity-time">2h ago</span>
          </div>
          <div class="home-activity-item">
            <div class="home-activity-dot"></div>
            <span class="home-activity-text">Maya C. completed her set!</span>
            <span class="home-activity-time">5h ago</span>
          </div>
        </div>
        <div class="tab-bar" id="tabBarHome"></div>
      </section>

      <!-- ===== SCREEN: GROUPS ===== -->
      <section class="screen" data-screen="groups">
        <div class="groups-header">
          <h2 class="groups-title">Groups</h2>
        </div>
        <div class="groups-create">
          <span class="groups-create-text">+ Create a Group</span>
        </div>
        <span class="groups-section-label">My Groups</span>
        <div class="groups-list">
          <div class="group-card">
            <div class="group-avatar">&#128694;</div>
            <div class="group-info">
              <span class="group-name">Savannah Strollers</span>
              <span class="group-members">24 members</span>
            </div>
          </div>
          <div class="group-card">
            <div class="group-avatar">&#9728;</div>
            <div class="group-info">
              <span class="group-name">Morning Walkers</span>
              <span class="group-members">18 members</span>
            </div>
          </div>
        </div>
        <span class="groups-section-label">Suggested Groups</span>
        <div class="groups-list">
          <div class="group-card">
            <div class="group-avatar">&#127793;</div>
            <div class="group-info">
              <span class="group-name">Trail Blazers</span>
              <span class="group-members">42 members</span>
            </div>
            <button class="group-join-btn">Join</button>
          </div>
          <div class="group-card">
            <div class="group-avatar">&#127774;</div>
            <div class="group-info">
              <span class="group-name">Weekend Warriors</span>
              <span class="group-members">31 members</span>
            </div>
            <button class="group-join-btn">Join</button>
          </div>
        </div>
        <div class="tab-bar" id="tabBarGroups"></div>
      </section>

      <!-- ===== SCREEN: REWARDS ===== -->
      <section class="screen" data-screen="rewards">
        <div class="rewards-header">
          <h2 class="rewards-title">Rewards</h2>
        </div>
        <div class="rewards-points-card">
          <span class="rewards-points-label">Available Points</span>
          <span class="rewards-points-val">2,450</span>
          <span class="rewards-points-sub">Earn more by collecting Field Notes</span>
        </div>
        <div class="rewards-grid">
          <div class="reward-card">
            <div class="reward-img">&#129507;</div>
            <div class="reward-info">
              <span class="reward-name">Mountain Classic Fleece</span>
              <span class="reward-pts">2,000 pts</span>
            </div>
          </div>
          <div class="reward-card">
            <div class="reward-img">&#127746;</div>
            <div class="reward-info">
              <span class="reward-name">Trail Model Rain Jacket</span>
              <span class="reward-pts">3,500 pts</span>
            </div>
          </div>
          <div class="reward-card">
            <div class="reward-img">&#128092;</div>
            <div class="reward-info">
              <span class="reward-name">Katahdin Day Pack</span>
              <span class="reward-pts">4,000 pts</span>
            </div>
          </div>
          <div class="reward-card">
            <div class="reward-img">&#9749;</div>
            <div class="reward-info">
              <span class="reward-name">Camp Mug</span>
              <span class="reward-pts">500 pts</span>
            </div>
          </div>
        </div>
        <div class="tab-bar" id="tabBarRewards"></div>
      </section>

      <!-- ===== SCREEN: LEADERBOARD ===== -->
      <section class="screen" data-screen="leaderboard">
        <div class="lb-nav">
          <span class="lb-back" onclick="go('profile','left')">&larr; Profile</span>
          <span class="lb-title">Leaderboard</span>
          <span style="width:50px;"></span>
        </div>
        <div class="lb-filter">
          <button class="lb-filter-btn active" onclick="this.parentNode.querySelector('.active').classList.remove('active');this.classList.add('active');">All Time</button>
          <button class="lb-filter-btn" onclick="this.parentNode.querySelector('.active').classList.remove('active');this.classList.add('active');">This Week</button>
        </div>
        <div class="lb-podium">
          <div class="podium-item">
            <div class="podium-rank">#2</div>
            <div class="podium-avatar silver">JL</div>
            <div class="podium-name">Jordan L.</div>
            <div class="podium-count">8/8</div>
          </div>
          <div class="podium-item" style="margin-bottom:12px;">
            <div class="podium-rank" style="font-size:12px;">&#9813;</div>
            <div class="podium-avatar gold" style="width:52px;height:52px;font-size:14px;">AM</div>
            <div class="podium-name">Alex M.</div>
            <div class="podium-count">8/8</div>
          </div>
          <div class="podium-item">
            <div class="podium-rank">#3</div>
            <div class="podium-avatar bronze">SK</div>
            <div class="podium-name">Sam K.</div>
            <div class="podium-count">7/8</div>
          </div>
        </div>
        <div class="lb-list" id="lbList"></div>
        <div class="tab-bar" id="tabBarLeaderboard"></div>
      </section>

      <!-- ===== SCREEN: FRIENDS ===== -->
      <section class="screen" data-screen="friends">
        <div class="friends-nav">
          <span class="friends-back" onclick="go('profile','left')">&larr; Profile</span>
          <span class="friends-title">Friends</span>
          <span class="friends-add">Add +</span>
        </div>
        <div class="friends-list" id="friendsList"></div>
        <div class="profile-section-label">Recent Activity</div>
        <div class="activity-section" id="activityFeed"></div>
        <!-- Comparison Overlay -->
        <div class="compare-overlay" id="compareOverlay">
          <div class="compare-header">
            <span class="compare-title" id="compareTitle">You vs Sarah M.</span>
            <button class="compare-close" onclick="hideComparison()">&times;</button>
          </div>
          <div class="compare-grid" id="compareGrid"></div>
          <div class="compare-legend">
            <span><span class="compare-legend-dot" style="background:var(--brand-forest);"></span> Both</span>
            <span><span class="compare-legend-dot" style="background:var(--brand-rust);"></span> Only you</span>
            <span><span class="compare-legend-dot" style="background:var(--dark-text-muted);"></span> Only them</span>
            <span><span class="compare-legend-dot" style="background:var(--dark-surface-alt);border:1px dashed var(--dark-text-muted);"></span> Neither</span>
          </div>
        </div>
      </section>

      <!-- ===== SCREEN: VIP / #GOGATHER ===== -->
      <section class="screen" data-screen="vip">
        <span class="vip-label">Exclusive Access</span>
        <div class="vip-pass">
          <div class="vip-pass-header">
            <span class="vip-pass-title">VIP ACCESS</span>
            <span class="vip-pass-check">&#10003;</span>
          </div>
          <div class="vip-pass-body">
            <div class="vip-user-avatar">KH</div>
            <span class="vip-user-name">Kim Harper</span>
            <span class="vip-member-id">FN-2026-0487</span>
            <hr class="vip-divider">
            <span class="vip-event-name">#GoGather by L.L.Bean</span>
            <span class="vip-event-date">March 15, 2026 &mdash; Forsyth Park</span>
          </div>
        </div>
        <ul class="vip-perks">
          <li class="vip-perk"><span class="vip-perk-icon">&#9733;</span><span class="vip-perk-text">Priority entry to #GoGather pop-up event</span></li>
          <li class="vip-perk"><span class="vip-perk-icon">&#127912;</span><span class="vip-perk-text">Exclusive rare print (only for complete collectors)</span></li>
          <li class="vip-perk"><span class="vip-perk-icon">&#128247;</span><span class="vip-perk-text">Meet the documentary photographer</span></li>
          <li class="vip-perk"><span class="vip-perk-icon">&#127873;</span><span class="vip-perk-text">$50 L.L.Bean digital gift card</span></li>
          <li class="vip-perk"><span class="vip-perk-icon">&#128444;</span><span class="vip-perk-text">Your print on the community wall</span></li>
        </ul>
        <div class="vip-actions">
          <button class="demo-btn gold" onclick="go('community')">RSVP to #GoGather</button>
          <button class="demo-btn ghost" onclick="go('community')" style="color:rgba(255,255,255,0.4);border-color:rgba(255,255,255,0.15);">Continue Demo &rarr;</button>
        </div>
      </section>

      <!-- ===== SCREEN 11: RARE ===== -->
      <section class="screen" data-screen="rare">
        <span class="rare-screen-title">Rare Edition</span>
        <div class="rare-container" id="rareContainer">
          <div class="rare-card-frame">
            <div class="rare-photo" style="background-image: url('images/07-gather.png');"></div>
            <div class="rare-info">
              <span class="rare-star-label">&#9733; RARE &#9733;</span>
              <span class="rare-title">THE GATHER</span>
              <span class="rare-ed">01 / 10</span>
            </div>
          </div>
        </div>
        <div style="width:100%;padding:0 24px;">
          <button class="demo-btn gold" onclick="go('complete')">Continue</button>
        </div>
      </section>

      <!-- ===== SCREEN 12: COMPLETE ===== -->
      <section class="screen" data-screen="complete">
        <div class="complete-slots" id="completeSlots"></div>
        <div class="complete-badge">&#10022; SET COMPLETE &#10022;</div>
        <h2 class="complete-title">You collected all 8<br>Field Notes</h2>
        <p class="complete-desc">
          Unlocked: Behind-the-scenes<br>mini-documentary + Urban Explorer badge
        </p>
        <div class="complete-bonus">
          <div class="detail-play">&#9654;</div>
          <div class="detail-video-text">
            <strong>Watch the full story</strong>
            <span>Mini-documentary &mdash; 5:00</span>
          </div>
        </div>
        <div style="width:100%;padding:0 24px;margin-top:8px;">
          <button class="demo-btn primary" onclick="go('vip')">Continue</button>
        </div>
      </section>

      <!-- ===== SCREEN 13: COMMUNITY ===== -->
      <section class="screen" data-screen="community">
        <h2 class="community-title">Community Milestone</h2>
        <div style="width:100%;">
          <div class="milestone-track">
            <div class="milestone-fill" id="milestoneFill" style="width: 97.4%;"></div>
          </div>
        </div>
        <span class="milestone-count"><span id="milestoneNum">487</span> of 500 prints activated city-wide</span>
        <div class="community-reveal" id="communityReveal">
          <div class="community-card">
            <span class="community-card-label">&#127758; COMMUNITY CARD</span>
            <span class="community-card-text">Unlocked for ALL participants</span>
          </div>
          <p class="community-desc">500 collectors came together<br>to unlock this shared moment.</p>
        </div>
        <div class="community-actions">
          <button class="demo-btn primary" onclick="restartDemo()">Restart Demo</button>
          <button class="demo-btn secondary" onclick="go('gear-hub')" style="margin-top:8px;width:100%;">&#128205; Explore Gear Library</button>
        </div>
      </section>

      <!-- ===== URBAN GEAR LIBRARY: HUB ===== -->
      <section class="screen" data-screen="gear-hub">
        <div class="gear-hero">
          <div class="gear-hero-overlay"></div>
          <div class="gear-hero-branding">
            <div class="gear-hero-icon">&#128205;</div>
            <div class="gear-hero-text">
              <span class="gear-hero-label">L.L. BEAN URBAN GEAR LIBRARY</span>
              <span class="gear-hero-title">Savannah</span>
            </div>
          </div>
          <div class="gear-hero-badge">
            <span class="gear-hero-badge-dot"></span>
            4 Locker Locations
          </div>
        </div>
        <div class="gear-hub-content">
          <div class="gear-hub-heading">Choose Your Location</div>
          <div class="gear-hub-sub">Select a gear locker near your next micro-adventure</div>
          <div id="gearHubList"></div>
        </div>
      </section>

      <!-- ===== URBAN GEAR LIBRARY: TYBEE ===== -->
      <section class="screen" data-screen="gear-tybee">
        <div class="gear-loc-header">
          <button class="gear-back-btn" onclick="go('gear-hub','left')">&#8592;</button>
          <div class="gear-loc-header-info">
            <div class="gear-loc-header-tag" style="color:#00B4D8;">
              <span class="dot" style="background:#00B4D8;"></span>TYBEE ISLAND
            </div>
            <div class="gear-loc-header-title">Beach Gear</div>
          </div>
          <div class="gear-loc-header-city">&#9992; Savannah, GA</div>
        </div>
        <div class="gear-bundle-grid" id="gearTybeeGrid"></div>
        <div class="gear-map-footer" id="gearTybeeMap"></div>
      </section>

      <!-- ===== URBAN GEAR LIBRARY: FORSYTH ===== -->
      <section class="screen" data-screen="gear-forsyth">
        <div class="gear-loc-header">
          <button class="gear-back-btn" onclick="go('gear-hub','left')">&#8592;</button>
          <div class="gear-loc-header-info">
            <div class="gear-loc-header-tag" style="color:#2D6A4F;">
              <span class="dot" style="background:#2D6A4F;"></span>FORSYTH PARK
            </div>
            <div class="gear-loc-header-title">Park Gear</div>
          </div>
          <div class="gear-loc-header-city">&#9992; Savannah, GA</div>
        </div>
        <div class="gear-bundle-grid" id="gearForsythGrid"></div>
        <div class="gear-map-footer" id="gearForsythMap"></div>
      </section>

      <!-- ===== URBAN GEAR LIBRARY: DAFFIN ===== -->
      <section class="screen" data-screen="gear-daffin">
        <div class="gear-loc-header">
          <button class="gear-back-btn" onclick="go('gear-hub','left')">&#8592;</button>
          <div class="gear-loc-header-info">
            <div class="gear-loc-header-tag" style="color:#2D6A4F;">
              <span class="dot" style="background:#2D6A4F;"></span>DAFFIN PARK
            </div>
            <div class="gear-loc-header-title">Park Gear</div>
          </div>
          <div class="gear-loc-header-city">&#9992; Savannah, GA</div>
        </div>
        <div class="gear-bundle-grid" id="gearDaffinGrid"></div>
        <div class="gear-map-footer" id="gearDaffinMap"></div>
      </section>

      <!-- ===== URBAN GEAR LIBRARY: VERIFICATION ===== -->
      <section class="screen" data-screen="gear-verify">
        <div class="gear-verify-header">
          <div class="gear-verify-top">
            <button class="gear-back-btn" id="gearVerifyBack">&#8592;</button>
            <div>
              <div style="font-size:18px;font-weight:800;color:var(--dark-text-primary);">Quick Verification</div>
              <div style="font-size:12px;color:var(--dark-text-secondary);" id="gearVerifyStepLabel">Step 1 of 3</div>
            </div>
          </div>
          <div class="gear-verify-progress">
            <div class="gear-verify-bar done" id="gvBar1"><div class="gear-verify-bar-fill"></div></div>
            <div class="gear-verify-bar" id="gvBar2"><div class="gear-verify-bar-fill"></div></div>
            <div class="gear-verify-bar" id="gvBar3"><div class="gear-verify-bar-fill"></div></div>
          </div>
        </div>
        <div class="gear-verify-steps" id="gearVerifySteps"></div>
        <div class="gear-verify-content" id="gearVerifyContent"></div>
        <div class="gear-verify-cta">
          <button class="demo-btn primary disabled" id="gearVerifyCta" onclick="gearVerifyNext()">Continue</button>
        </div>
      </section>

      <!-- ===== URBAN GEAR LIBRARY: UNLOCK ===== -->
      <section class="screen" data-screen="gear-unlock">
        <div class="gear-unlock-header">
          <div class="gear-unlock-badge">L.L. BEAN URBAN GEAR LIBRARY</div>
          <div class="gear-unlock-title" id="gearUnlockTitle">Ready to Unlock</div>
          <div class="gear-unlock-subtitle" id="gearUnlockSub">Slide to open your locker</div>
        </div>
        <div class="gear-unlock-info" id="gearUnlockInfo"></div>
        <div class="gear-countdown" id="gearCountdown">
          <span class="gear-countdown-label">Time to collect gear</span>
          <span class="gear-countdown-time" id="gearCountdownTime">5:00</span>
        </div>
        <div class="gear-success-card" id="gearSuccessCard" style="display:none;"></div>
        <div style="flex:1;"></div>
        <div id="gearSliderSection">
          <div class="gear-slider-wrap">
            <div class="gear-slider-track" id="gearSliderTrack">
              <div class="gear-slider-label" id="gearSliderLabel">SLIDE TO UNLOCK</div>
              <div class="gear-slider-thumb" id="gearSliderThumb">&#10145;</div>
            </div>
            <div class="gear-slider-hint">Drag the slider to open locker #12</div>
          </div>
        </div>
        <div class="gear-unlock-actions" id="gearUnlockActions" style="display:none;padding:0 20px 20px;">
          <button class="demo-btn secondary" onclick="go('gear-hub','left')" style="width:100%;margin-bottom:8px;">Return Home</button>
          <div class="gear-return-note" id="gearReturnNote">Remember to return your gear to any locker within 4 hours</div>
        </div>
        <div class="gear-lock-overlay" id="gearLockOverlay">&#128274;</div>
      </section>

    </div>
  </div>

  <!-- PROGRESS DOTS -->
  <div class="demo-dots" id="demoDots"></div>

</div>

<script>
// ============================================================
// DATA MODEL
// ============================================================

const LOCATIONS = [
  { id:1, name:'The Commute', cp:'CP1', image:'images/01-commute.png', caption:'"Where the sidewalk keeps time"', story:'She matched her pace to the city \u2014 the rhythm of crosswalks, the cadence of bus doors opening and closing. Every morning the same route, but the light was never the same twice.', edition:'08/50', date:'Jan 12', mapX:72, mapY:105 },
  { id:2, name:'The Stoop', cp:'CP2', image:'images/02-stoop.jpg', caption:'"Between the door and the world"', story:'The stoop was neutral ground \u2014 not inside, not outside. A place to watch the block wake up. The wrought iron held the morning heat and the flag barely moved.', edition:'23/50', date:'Jan 14', mapX:48, mapY:168 },
  { id:3, name:'The Park', cp:'CP3', image:'images/03-park.png', caption:'"Every corner has a story"', story:'She found the bench between the oak trees. Not the quiet she expected \u2014 kids on bikes, someone\u2019s speaker playing soft. A different kind of outdoors, but hers all the same.', edition:'12/50', date:'Jan 15', mapX:55, mapY:258 },
  { id:4, name:'The Rooftop', cp:'CP4', image:'images/04-rooftop.png', caption:'"The sky belongs to everyone"', story:'Six floors up, the city flattened into a quilt of rooftops and treetops. The horizon line blurred where the river met the marshes. She stayed until the streetlights won.', edition:'31/50', date:'Jan 18', mapX:105, mapY:145 },
  { id:5, name:'The Market', cp:'CP5', image:null, caption:'"Where strangers share tables"', story:null, edition:null, date:null, mapX:55, mapY:220 },
  { id:6, name:'The Bridge', cp:'CP6', image:'images/06-bridge.jpg', caption:'"Where the trail meets the tide"', story:'The bridge was the border between here and somewhere else. Below, the river pushed east. Above, the cables hummed a pitch that changed with the wind.', edition:'07/50', date:'Feb 13', mapX:55, mapY:35 },
  { id:7, name:'The Gather', cp:'CP7', image:'images/07-gather.png', caption:'"We came as strangers"', story:'Someone brought a speaker. Someone else brought coffee. By sundown they were trading prints, comparing notes, arguing about which checkpoint had the best light.', edition:'04/50', date:'Feb 10', mapX:148, mapY:72 },
  { id:8, name:'The Promise', cp:'CP8', image:'images/08-promise.jpg', caption:'"What we leave behind"', story:'The locks on the bridge railing told a hundred small promises. Some rusted. Some new. She clipped hers on without a word and walked into the evening.', edition:'19/50', date:'Feb 13', mapX:125, mapY:75 }
];

const SCREEN_ORDER = ['onboard-1','onboard-2','onboard-3','vending','print','scan','loading','reveal','confirm','home','gallery','detail','map','groups','profile','leaderboard','friends','rewards','rare','complete','vip','community','gear-hub','gear-tybee','gear-forsyth','gear-daffin','gear-verify','gear-unlock'];

const NARRATOR_TEXT = {
  'onboard-1': 'The app introduces the Outdoor Walking Experience \u2014 discover hidden checkpoints across the city.',
  'onboard-2': 'Three steps: Explore the trail, tap NFC at vending machines, and unlock digital collectibles.',
  'onboard-3': 'Walk together \u2014 join groups, compete on leaderboards, and explore with friends.',
  vending: 'The user approaches a Field Notes vending machine and browses available prints on the touchscreen.',
  print: 'A 2\u00d73" documentary photo print is dispensed. The user flips it over to find a QR code.',
  scan: 'The user scans the QR code using their phone\u2019s native camera. No app install needed.',
  loading: 'The web app activates the unique print, linking the physical artifact to a digital collectible.',
  reveal: 'The digital card is revealed with a 3D flip animation. The photo comes alive on screen.',
  confirm: 'The card is added to the user\u2019s personal Field Notes collection. Progress updated.',
  home: 'The home dashboard shows trail progress, points earned, and recent activity at a glance.',
  gallery: 'The gallery shows all collected and undiscovered cards. Tap any card for its full story.',
  detail: 'Each card holds a documentary story excerpt and 45 seconds of video footage.',
  map: 'The collection map shows all 8 checkpoint locations across Savannah.',
  groups: 'Join walking groups to explore the trail together and earn bonus points.',
  rare: 'At pop-up events, rare gold-edition prints unlock animated digital cards (10 per location).',
  complete: 'Collecting all 8 Field Notes unlocks a behind-the-scenes mini-documentary.',
  profile: 'The user\u2019s profile shows collection progress, achievements, and social connections.',
  leaderboard: 'A city-wide leaderboard drives friendly competition among Savannah collectors.',
  friends: 'Friends can compare collections and track each other\u2019s progress in real time.',
  rewards: 'Earn points by collecting Field Notes and redeem them for L.L.Bean gear.',
  vip: 'Completing all 8 Field Notes earns VIP access to the #GoGather L.L.Bean pop-up event.',
  community: 'When 500 prints are activated city-wide, a community card unlocks for everyone.',
  'gear-hub': 'The Urban Gear Library \u2014 rental kiosks in Savannah\u2019s green spaces. Choose a locker location.',
  'gear-tybee': 'Tybee Island beach gear bundles \u2014 cabanas, paddleboards, and beach games for the day.',
  'gear-forsyth': 'Forsyth Park gear \u2014 hammocks, firepits, lawn games, and blankets for the perfect afternoon.',
  'gear-daffin': 'Daffin Park community gear \u2014 firepits, lawn games, and hammocks in Midtown Savannah.',
  'gear-verify': 'Quick verification \u2014 phone number, photo ID, and a refundable deposit to unlock your locker.',
  'gear-unlock': 'Slide to unlock the locker and grab your gear. Enjoy your micro-adventure!'
};

let state = {
  currentScreen: 'onboard-1',
  collected: new Set([1, 2, 4]),
  allCollected: false,
  detailCard: null
};

// ============================================================
// SCREEN NAVIGATION
// ============================================================

function go(screenId, direction) {
  const current = document.querySelector('.screen.active');
  const next = document.querySelector(`[data-screen="${screenId}"]`);
  if (!next || current === next) return;

  // Exit current
  if (current) {
    current.classList.remove('active');
    current.classList.add('exit');
    setTimeout(() => current.classList.remove('exit'), 300);
  }

  // Enter next
  if (direction === 'left') {
    next.style.animation = 'screen-enter-left 0.35s ease-out';
  } else {
    next.style.animation = 'screen-enter 0.35s ease-out';
  }
  setTimeout(() => { next.classList.add('active'); }, 10);

  state.currentScreen = screenId;
  updateNarrator(screenId);
  updateDots(screenId);
  updateStatusBar(screenId);

  // Render tab bar on screens that have one
  if (TAB_SCREENS.includes(screenId)) {
    renderTabBar(screenId);
  }

  // Screen-specific triggers
  if (screenId === 'scan') triggerScan();
  if (screenId === 'loading') triggerLoading();
  if (screenId === 'reveal') triggerReveal();
  if (screenId === 'confirm') triggerConfirm();
  if (screenId === 'home') renderHome();
  if (screenId === 'gallery') renderGallery();
  if (screenId === 'map') renderMap();
  if (screenId === 'profile') renderProfile();
  if (screenId === 'leaderboard') renderLeaderboard();
  if (screenId === 'friends') renderFriends();
  if (screenId === 'rare') triggerRare();
  if (screenId === 'complete') triggerComplete();
  if (screenId === 'community') triggerCommunity();
  if (screenId === 'gear-hub') renderGearHub();
  if (screenId === 'gear-tybee') renderGearLocation('tybee');
  if (screenId === 'gear-forsyth') renderGearLocation('forsyth');
  if (screenId === 'gear-daffin') renderGearLocation('daffin');
  if (screenId === 'gear-verify') renderGearVerify();
  if (screenId === 'gear-unlock') renderGearUnlock();
}

// ============================================================
// SCREEN-SPECIFIC LOGIC
// ============================================================

function flipPrint() {
  const card = document.getElementById('printCard');
  if (card.classList.contains('flipped')) {
    go('scan');
  } else {
    card.classList.add('flipped');
    document.getElementById('printInstruction').textContent = 'Tap the QR code to scan it.';
  }
}

function triggerScan() {
  setTimeout(() => {
    document.querySelectorAll('.scan-corner').forEach(c => c.classList.add('found'));
    setTimeout(() => go('loading'), 400);
  }, 1200);
}

function triggerLoading() {
  const fill = document.getElementById('loadingFill');
  fill.classList.remove('animate');
  void fill.offsetWidth;
  fill.classList.add('animate');
  setTimeout(() => go('reveal'), 2800);
}

function triggerReveal() {
  const card = document.getElementById('revealCard');
  card.classList.remove('flip');
  void card.offsetWidth;
  setTimeout(() => card.classList.add('flip'), 300);
  setTimeout(() => {
    document.getElementById('revealBtnWrap').classList.add('visible');
  }, 1200);
}

function triggerConfirm() {
  state.collected.add(3);
  setTimeout(() => {
    document.getElementById('confirmProgress').style.width = '50%';
  }, 400);
}

function renderHome() {
  const count = state.collected.size;
  const pct = Math.round((count / 8) * 100);
  const homeTrailPct = document.getElementById('homeTrailPct');
  const homeTrailLabel = document.getElementById('homeTrailLabel');
  const homeTrailFill = document.getElementById('homeTrailFill');
  if (homeTrailPct) homeTrailPct.textContent = pct + '%';
  if (homeTrailLabel) homeTrailLabel.textContent = count + ' of 8 collected';
  if (homeTrailFill) homeTrailFill.style.width = pct + '%';
}

function renderGallery() {
  const grid = document.getElementById('galleryGrid');
  grid.innerHTML = '';
  const count = state.collected.size;
  document.getElementById('galleryProgressLabel').textContent = `${count} of 8 locations discovered`;
  document.getElementById('galleryProgressFill').style.width = `${(count/8)*100}%`;
  document.getElementById('fastForwardBtn').style.display = state.allCollected ? 'none' : 'block';

  LOCATIONS.forEach(loc => {
    const card = document.createElement('div');
    const isCollected = state.collected.has(loc.id);
    card.className = `gallery-card ${isCollected ? 'collected' : 'locked'}`;

    if (isCollected && loc.image) {
      card.innerHTML = `
        <div class="gallery-card-photo" style="background-image:url('${loc.image}');"></div>
        <div class="gallery-card-name">${loc.name}</div>
        <div class="gallery-card-date">${loc.date}</div>
      `;
      card.onclick = () => showDetail(loc.id);
    } else {
      card.innerHTML = `
        <div class="gallery-card-lock">&#128274;</div>
        <div class="gallery-card-name" style="color:var(--dark-text-muted);">???</div>
        <div class="gallery-card-date">&nbsp;</div>
      `;
      card.onclick = () => { card.classList.add('shake'); setTimeout(() => card.classList.remove('shake'), 400); };
    }
    grid.appendChild(card);
  });
}

function showDetail(id) {
  const loc = LOCATIONS.find(l => l.id === id);
  if (!loc) return;
  state.detailCard = id;
  document.getElementById('detailPhoto').style.backgroundImage = `url('${loc.image}')`;
  document.getElementById('detailLocation').textContent = `${loc.cp}: ${loc.name}`;
  document.getElementById('detailDate').textContent = `Collected ${loc.date}, 2026`;
  document.getElementById('detailEdition').textContent = `Edition ${loc.edition}`;
  document.getElementById('detailStory').textContent = loc.story;
  go('detail');
}

function renderMap() {
  const pins = document.getElementById('mapPins');
  pins.innerHTML = '';
  LOCATIONS.forEach(loc => {
    const isCollected = state.collected.has(loc.id);
    const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
    const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
    circle.setAttribute('cx', loc.mapX);
    circle.setAttribute('cy', loc.mapY);
    circle.setAttribute('r', '8');
    if (isCollected) {
      circle.setAttribute('fill', '#2C5F2D');
      circle.setAttribute('stroke', '#3A7D3C');
      circle.setAttribute('stroke-width', '1.5');
    } else {
      circle.setAttribute('fill', 'none');
      circle.setAttribute('stroke', 'rgba(255,255,255,0.25)');
      circle.setAttribute('stroke-width', '1.5');
      circle.setAttribute('stroke-dasharray', '3 2');
    }
    g.appendChild(circle);

    const num = document.createElementNS('http://www.w3.org/2000/svg', 'text');
    num.setAttribute('x', loc.mapX);
    num.setAttribute('y', loc.mapY + 3);
    num.setAttribute('text-anchor', 'middle');
    num.setAttribute('font-family', 'monospace');
    num.setAttribute('font-size', '7');
    num.setAttribute('font-weight', 'bold');
    num.setAttribute('fill', isCollected ? 'white' : 'rgba(255,255,255,0.3)');
    num.textContent = loc.id;
    g.appendChild(num);

    pins.appendChild(g);
  });
}

function triggerRare() {
  const container = document.getElementById('rareContainer');
  // Add sparkles
  const existingSparkles = container.querySelectorAll('.sparkle');
  existingSparkles.forEach(s => s.remove());
  for (let i = 0; i < 10; i++) {
    const s = document.createElement('div');
    s.className = 'sparkle';
    s.style.top = `${Math.random() * 100}%`;
    s.style.left = `${Math.random() * 100}%`;
    s.style.animationDelay = `${Math.random() * 2}s`;
    container.appendChild(s);
  }
}

function triggerComplete() {
  const slots = document.getElementById('completeSlots');
  slots.innerHTML = '';
  for (let i = 0; i < 8; i++) {
    const slot = document.createElement('div');
    slot.className = 'complete-slot';
    slot.textContent = '\u2713';
    slot.style.animationDelay = `${i * 0.12}s`;
    setTimeout(() => slot.classList.add('filled'), 10);
    slots.appendChild(slot);
  }
  // Confetti
  const screen = document.querySelector('[data-screen="complete"]');
  screen.querySelectorAll('.confetti').forEach(c => c.remove());
  const colors = ['#2C5F2D', '#3A7D3C', '#CC7722', '#F5F3EE'];
  for (let i = 0; i < 30; i++) {
    const c = document.createElement('div');
    c.className = 'confetti';
    c.style.left = `${Math.random() * 100}%`;
    c.style.background = colors[Math.floor(Math.random() * colors.length)];
    c.style.animationDelay = `${Math.random() * 1.5}s`;
    c.style.width = `${4 + Math.random() * 4}px`;
    c.style.height = `${4 + Math.random() * 4}px`;
    screen.appendChild(c);
  }
}

function triggerCommunity() {
  let count = 487;
  const numEl = document.getElementById('milestoneNum');
  const fillEl = document.getElementById('milestoneFill');
  const revealEl = document.getElementById('communityReveal');
  revealEl.classList.remove('visible');
  fillEl.style.width = '97.4%';
  numEl.textContent = '487';

  const interval = setInterval(() => {
    count++;
    numEl.textContent = count;
    fillEl.style.width = `${(count / 500) * 100}%`;
    if (count >= 500) {
      clearInterval(interval);
      setTimeout(() => revealEl.classList.add('visible'), 300);
    }
  }, 200);
}

// ============================================================
// SOCIAL DATA MODELS
// ============================================================

const LEADERBOARD = [
  { rank:1, name:'Alex M.', init:'AM', count:8, total:8 },
  { rank:2, name:'Jordan L.', init:'JL', count:8, total:8 },
  { rank:3, name:'Sam K.', init:'SK', count:7, total:8 },
  { rank:4, name:'Taylor R.', init:'TR', count:6, total:8 },
  { rank:5, name:'Kim H.', init:'KH', count:4, total:8, isUser:true },
  { rank:6, name:'Riley J.', init:'RJ', count:4, total:8 },
  { rank:7, name:'Morgan P.', init:'MP', count:3, total:8 },
  { rank:8, name:'Casey W.', init:'CW', count:3, total:8 }
];

const FRIENDS = [
  { name:'Sarah M.', initial:'S', count:6, total:8, has:[1,2,3,4,6,7] },
  { name:'David R.', initial:'D', count:5, total:8, has:[1,3,4,5,7] },
  { name:'Maya C.', initial:'M', count:8, total:8, has:[1,2,3,4,5,6,7,8] },
  { name:'James T.', initial:'J', count:3, total:8, has:[1,3,7] }
];

const ACTIVITY = [
  { text:'Sarah just collected The Bridge!', time:'2h ago' },
  { text:'Maya completed her set!', time:'5h ago' },
  { text:'David found a rare Gather!', time:'1d ago' }
];

const BADGES = [
  { name:'Urban Explorer', icon:'\u{1F9ED}', desc:'Collected 4+ Field Notes', color:'var(--brand-forest)', earned:true },
  { name:'Early Bird', icon:'\u{1F305}', desc:'First 50 to find a location', color:'var(--brand-ochre)', earned:true },
  { name:'Rare Hunter', icon:'\u2B50', desc:'Found a rare edition', color:'var(--brand-rust)', earned:true },
  { name:'Social Butterfly', icon:'\u{1F98B}', desc:'Shared 3 cards', color:'var(--dark-text-muted)', earned:false }
];

// ============================================================
// SOCIAL RENDER FUNCTIONS
// ============================================================

function renderProfile() {
  const count = state.collected.size;
  document.getElementById('profileCollected').textContent = `${count}/8`;
  document.getElementById('breakdownStandard').style.width = `${(count/8)*100}%`;
  document.getElementById('breakdownStdCount').textContent = `${count}/8`;

  const grid = document.getElementById('badgeGrid');
  grid.innerHTML = '';
  BADGES.forEach(b => {
    const item = document.createElement('div');
    item.className = 'badge-item' + (b.earned ? '' : ' locked');
    item.innerHTML = `
      <div class="badge-icon" style="background:${b.earned ? b.color : 'var(--dark-surface-alt)'};opacity:${b.earned ? '0.15' : '0.3'};">
        <span style="opacity:${b.earned ? '1' : '0.5'};position:relative;">${b.icon}</span>
      </div>
      <div>
        <span class="badge-name">${b.name}</span>
        <span class="badge-desc">${b.desc}</span>
      </div>
    `;
    grid.appendChild(item);
  });
}

function renderLeaderboard() {
  const list = document.getElementById('lbList');
  list.innerHTML = '';
  LEADERBOARD.filter(e => e.rank > 3).forEach(entry => {
    const row = document.createElement('div');
    row.className = 'lb-row' + (entry.isUser ? ' is-user' : '');
    row.innerHTML = `
      <span class="lb-rank">${entry.rank}</span>
      <div class="lb-avatar-sm">${entry.init}</div>
      <span class="lb-name">${entry.name}${entry.isUser ? ' (You)' : ''}</span>
      <span class="lb-score">${entry.count}/${entry.total}</span>
    `;
    list.appendChild(row);
  });
}

function renderFriends() {
  const list = document.getElementById('friendsList');
  list.innerHTML = '';
  FRIENDS.forEach((f, i) => {
    const row = document.createElement('div');
    row.className = 'friend-row';
    row.onclick = () => showComparison(i);
    const pct = (f.count / f.total) * 100;
    row.innerHTML = `
      <div class="friend-avatar">${f.initial}</div>
      <div class="friend-info">
        <div class="friend-name">${f.name}${f.count === f.total ? ' <span class="friend-complete-badge">Completed!</span>' : ''}</div>
        <div class="friend-progress-wrap">
          <div class="friend-track"><div class="friend-fill" style="width:${pct}%;"></div></div>
          <span class="friend-count">${f.count}/${f.total}</span>
        </div>
      </div>
      <span class="friend-compare-hint">&rsaquo;</span>
    `;
    list.appendChild(row);
  });

  const feed = document.getElementById('activityFeed');
  feed.innerHTML = '';
  ACTIVITY.forEach(a => {
    const item = document.createElement('div');
    item.className = 'activity-item';
    item.innerHTML = `
      <div class="activity-dot"></div>
      <div>
        <span class="activity-text">${a.text}</span>
        <span class="activity-time">${a.time}</span>
      </div>
    `;
    feed.appendChild(item);
  });
}

function showComparison(friendIdx) {
  const friend = FRIENDS[friendIdx];
  const overlay = document.getElementById('compareOverlay');
  const grid = document.getElementById('compareGrid');
  document.getElementById('compareTitle').textContent = `You vs ${friend.name}`;

  grid.innerHTML = '';
  LOCATIONS.forEach(loc => {
    const youHave = state.collected.has(loc.id);
    const theyHave = friend.has.includes(loc.id);
    const card = document.createElement('div');
    let cls, label;
    if (youHave && theyHave) { cls = 'both'; label = loc.name.replace('The ',''); }
    else if (youHave) { cls = 'you-only'; label = loc.name.replace('The ',''); }
    else if (theyHave) { cls = 'friend-only'; label = loc.name.replace('The ',''); }
    else { cls = 'neither'; label = '???'; }
    card.className = `compare-card ${cls}`;
    card.textContent = label;
    grid.appendChild(card);
  });

  overlay.classList.add('visible');
}

function hideComparison() {
  document.getElementById('compareOverlay').classList.remove('visible');
}

function fastForward() {
  state.collected = new Set([1,2,3,4,5,6,7,8]);
  state.allCollected = true;

  // Quick cascade animation on gallery cards
  const cards = document.querySelectorAll('.gallery-card.locked');
  cards.forEach((card, i) => {
    setTimeout(() => {
      card.classList.remove('locked');
      card.classList.add('collected');
      const loc = LOCATIONS[parseInt(card.dataset?.index) || 0];
      card.style.animation = 'check-pop 0.3s ease-out';
    }, i * 150);
  });

  // Update progress
  document.getElementById('galleryProgressLabel').textContent = '8 of 8 locations discovered';
  document.getElementById('galleryProgressFill').style.width = '100%';
  document.getElementById('fastForwardBtn').style.display = 'none';

  // After cascade, re-render and go to rare
  setTimeout(() => {
    renderGallery();
    setTimeout(() => go('rare'), 400);
  }, 800);
}

function restartDemo() {
  state.collected = new Set([1, 2, 4]);
  state.allCollected = false;
  state.detailCard = null;

  // Reset print card
  const printCard = document.getElementById('printCard');
  printCard.classList.remove('flipped');
  document.getElementById('printInstruction').textContent = 'Your print has been dispensed. Tap to flip it over.';

  // Reset reveal
  document.getElementById('revealCard').classList.remove('flip');
  document.getElementById('revealBtnWrap').classList.remove('visible');

  // Reset scan corners
  document.querySelectorAll('.scan-corner').forEach(c => c.classList.remove('found'));

  // Reset confirm progress
  document.getElementById('confirmProgress').style.width = '37.5%';

  // Reset loading bar
  document.getElementById('loadingFill').classList.remove('animate');

  // Reset comparison overlay
  hideComparison();

  // Reset gear state
  gearState.currentStep = 1;
  gearState.phoneComplete = false;
  gearState.idVerified = false;
  gearState.cardVerified = false;
  gearState.selectedBundle = null;
  gearState.selectedLocation = null;
  gearState.isUnlocked = false;
  if (gearState.countdownTimer) clearInterval(gearState.countdownTimer);

  // Reset leaderboard filter
  const lbFilters = document.querySelectorAll('.lb-filter-btn');
  lbFilters.forEach((btn, i) => btn.classList.toggle('active', i === 0));

  go('onboard-1');
}

// ============================================================
// UI HELPERS
// ============================================================

function updateNarrator(screenId) {
  const text = NARRATOR_TEXT[screenId] || '';
  document.getElementById('narratorText').textContent = text;
}

function toggleNarrator() {
  const el = document.getElementById('narrator');
  el.classList.toggle('hidden');
}

function updateStatusBar(screenId) {
  const bar = document.getElementById('statusBar');
  bar.className = 'status-bar light';
}

function updateDots(screenId) {
  const idx = SCREEN_ORDER.indexOf(screenId);
  document.querySelectorAll('.demo-dot').forEach((dot, i) => {
    dot.classList.toggle('active', i === idx);
  });
}

// ============================================================
// URBAN GEAR LIBRARY — DATA & LOGIC
// ============================================================

const GEAR_LOCATIONS = [
  { id:'tybee', name:'Tybee Island', area:'Beach', terrain:'Oceanfront', icon:'\u{1F30A}', lockerCount:2, distance:'18 mi east', color:'#00B4D8', screen:'gear-tybee' },
  { id:'forsyth', name:'Forsyth Park', area:'Historic District', terrain:'Urban Park', icon:'\u{1F332}', lockerCount:1, distance:'2 mi south', color:'#2D6A4F', screen:'gear-forsyth' },
  { id:'daffin', name:'Daffin Park', area:'Midtown', terrain:'Community Park', icon:'\u{1F334}', lockerCount:1, distance:'3 mi east', color:'#2D6A4F', screen:'gear-daffin' }
];

const GEAR_BUNDLES = {
  tybee: [
    { id:'shoreline-shelter', name:'The Shoreline Shelter', gear:['Sunbuster Cabana','2x Beach Chairs','Blanket'], icons:['\u2602','\u{1FA91}','\u{1F9F6}'], proximity:'2 min walk', duration:'4 hrs', price:'$12' },
    { id:'wave-rider', name:'The Wave Rider', gear:['Inflatable SUP','Life Vest'], icons:['\u{1F3C4}','\u{1F9BA}'], proximity:'1 min walk', duration:'3 hrs', price:'$15' },
    { id:'sand-social', name:'The Sand Social', gear:['Spikeball Set','Blanket','Dry Bag'], icons:['\u{1F3D0}','\u{1F9F6}','\u{1F392}'], proximity:'3 min walk', duration:'4 hrs', price:'$10' }
  ],
  forsyth: [
    { id:'fireside-hangout', name:'The Fireside Hangout', gear:['Solo Stove Mesa','2x Chairs','Blanket','Speaker'], icons:['\u{1F525}','\u{1FA91}','\u{1F9F6}','\u{1F50A}'], proximity:'2 min walk', duration:'4 hrs', price:'$12' },
    { id:'lawn-game-legend', name:'The Lawn Game Legend', gear:['Ladder Toss','Puffer Blanket','Speaker'], icons:['\u{1F3AF}','\u{1F9F6}','\u{1F50A}'], proximity:'3 min walk', duration:'5 hrs', price:'$10' },
    { id:'canopy-escape', name:'The Canopy Escape', gear:['Hammock + Straps','Speaker','Puffer Blanket'], icons:['\u{1F332}','\u{1F50A}','\u{1F9F6}'], proximity:'1 min walk', duration:'4 hrs', price:'$8' }
  ],
  daffin: [
    { id:'fireside-hangout-d', name:'The Fireside Hangout', gear:['Solo Stove Mesa','2x Chairs','Blanket','Speaker'], icons:['\u{1F525}','\u{1FA91}','\u{1F9F6}','\u{1F50A}'], proximity:'3 min walk', duration:'4 hrs', price:'$12' },
    { id:'lawn-game-legend-d', name:'The Lawn Game Legend', gear:['Ladder Toss','Puffer Blanket','Speaker'], icons:['\u{1F3AF}','\u{1F9F6}','\u{1F50A}'], proximity:'2 min walk', duration:'5 hrs', price:'$10' },
    { id:'canopy-escape-d', name:'The Canopy Escape', gear:['Hammock + Straps','Speaker','Puffer Blanket'], icons:['\u{1F332}','\u{1F50A}','\u{1F9F6}'], proximity:'1 min walk', duration:'4 hrs', price:'$8' }
  ]
};

const GEAR_LOCKERS = {
  tybee: [
    { name:'Tybee Pavilion', distance:'1 min', terrain:'Beach Access' },
    { name:'South Beach', distance:'8 min', terrain:'Surf Zone' }
  ],
  forsyth: [
    { name:'Forsyth Park - Main Entrance', distance:'Right here', terrain:'Historic District' }
  ],
  daffin: [
    { name:'Daffin Park - Main Entrance', distance:'Right here', terrain:'Community Park' }
  ]
};

let gearState = {
  currentStep: 1,
  phoneComplete: false,
  idVerified: false,
  cardVerified: false,
  selectedBundle: null,
  selectedLocation: null,
  countdownTimer: null,
  isUnlocked: false
};

function renderGearHub() {
  const list = document.getElementById('gearHubList');
  list.innerHTML = '';
  GEAR_LOCATIONS.forEach(loc => {
    const card = document.createElement('div');
    card.className = 'gear-location-card';
    card.onclick = () => go(loc.screen);
    card.innerHTML = `
      <div class="gear-loc-img">
        ${loc.icon}
        <span class="gear-loc-badge" style="background:${loc.color};">${loc.lockerCount} ${loc.lockerCount > 1 ? 'Lockers' : 'Locker'}</span>
      </div>
      <div class="gear-loc-info">
        <span class="gear-loc-name">${loc.name}</span>
        <span class="gear-loc-area">${loc.area}</span>
        <div class="gear-loc-tags">
          <span class="gear-loc-tag terrain">${loc.terrain}</span>
          <span class="gear-loc-tag">&#128205; ${loc.distance}</span>
        </div>
      </div>
      <div class="gear-loc-icon-wrap" style="background:${loc.color}15;">
        <span style="color:${loc.color};">${loc.icon}</span>
      </div>
    `;
    list.appendChild(card);
  });
}

function renderGearLocation(locId) {
  const bundles = GEAR_BUNDLES[locId] || [];
  const lockers = GEAR_LOCKERS[locId] || [];
  const loc = GEAR_LOCATIONS.find(l => l.id === locId);
  const color = loc ? loc.color : '#2D6A4F';

  const gridId = locId === 'tybee' ? 'gearTybeeGrid' : locId === 'forsyth' ? 'gearForsythGrid' : 'gearDaffinGrid';
  const mapId = locId === 'tybee' ? 'gearTybeeMap' : locId === 'forsyth' ? 'gearForsythMap' : 'gearDaffinMap';

  const grid = document.getElementById(gridId);
  grid.innerHTML = '';
  bundles.forEach(bundle => {
    const card = document.createElement('div');
    card.className = 'gear-bundle-card';
    card.onclick = () => {
      gearState.selectedBundle = bundle;
      gearState.selectedLocation = locId;
      go('gear-verify');
    };
    card.innerHTML = `
      <div class="gear-bundle-img" style="background:linear-gradient(135deg, ${color}40, ${color}20);">
        <span style="z-index:1;position:relative;">${bundle.icons[0]}</span>
        <span class="gear-bundle-proximity" style="background:${color};">${bundle.proximity}</span>
        <span class="gear-bundle-price-tag">${bundle.price}</span>
      </div>
      <div class="gear-bundle-body">
        <div class="gear-bundle-name">${bundle.name}</div>
        ${bundle.gear.map((item, i) => `
          <div class="gear-item-row">
            <div class="gear-item-icon" style="background:${color}20;color:${color};">${bundle.icons[i] || '\u{1F4E6}'}</div>
            <span class="gear-item-text">${item}</span>
          </div>
        `).join('')}
        <div class="gear-bundle-duration">${bundle.duration}</div>
      </div>
    `;
    grid.appendChild(card);
  });

  // Render map footer
  const mapEl = document.getElementById(mapId);
  const terrainLabel = loc ? loc.terrain : 'Park';
  mapEl.innerHTML = `
    <div class="gear-map-heading">
      <div class="gear-map-heading-left">&#9992; SMART MAP</div>
      <span class="gear-map-terrain">${terrainLabel}</span>
    </div>
    <div class="gear-map-visual" style="background:${color}15;">
      <svg width="100%" height="100%" style="position:absolute;inset:0;opacity:0.1;">
        <pattern id="gm-${locId}" width="15" height="15" patternUnits="userSpaceOnUse">
          <path d="M 15 0 L 0 0 0 15" fill="none" stroke="${color}" stroke-width="0.5"/>
        </pattern>
        <rect width="100%" height="100%" fill="url(#gm-${locId})"/>
      </svg>
      ${lockers.map((l, i) => `
        <div class="gear-map-pin" style="background:${color};top:50%;left:${20 + i * 55}%;transform:translate(-50%,-50%);">
          &#128205;
          <span style="position:absolute;inset:-4px;border-radius:50%;background:${color};animation:gear-pin-pulse 2s ease-in-out infinite ${i * 0.3}s;"></span>
        </div>
      `).join('')}
      <div style="position:absolute;bottom:4px;right:8px;background:rgba(26,26,26,0.8);padding:2px 8px;border-radius:4px;font-size:9px;font-weight:600;color:var(--dark-text-secondary);">${terrainLabel}</div>
    </div>
    ${lockers.map(l => `
      <div class="gear-locker-row">
        <div class="gear-locker-row-left">
          <span class="gear-locker-dot" style="background:${color};"></span>
          ${l.name}
        </div>
        <span class="gear-locker-dist" style="background:${color};">${l.distance}</span>
      </div>
    `).join('')}
  `;
}

// ============================================================
// GEAR VERIFICATION
// ============================================================

function renderGearVerify() {
  gearState.currentStep = 1;
  gearState.phoneComplete = false;
  gearState.idVerified = false;
  gearState.cardVerified = false;

  // Back button goes to the selected location
  const backBtn = document.getElementById('gearVerifyBack');
  backBtn.onclick = () => {
    const locScreen = gearState.selectedLocation ? 'gear-' + gearState.selectedLocation : 'gear-hub';
    go(locScreen, 'left');
  };

  updateGearVerifyUI();
}

function updateGearVerifyUI() {
  const step = gearState.currentStep;
  document.getElementById('gearVerifyStepLabel').textContent = `Step ${step} of 3`;

  // Progress bars
  ['gvBar1','gvBar2','gvBar3'].forEach((id, i) => {
    const bar = document.getElementById(id);
    bar.className = 'gear-verify-bar' + (i < step ? ' done' : '');
  });

  // Step indicators
  const stepsData = [
    { icon:'\u{1F4F1}', label:'Phone Number' },
    { icon:'\u{1F4F7}', label:'Photo ID' },
    { icon:'\u{1F4B3}', label:'Payment Hold' }
  ];
  const stepsEl = document.getElementById('gearVerifySteps');
  stepsEl.innerHTML = '';
  stepsData.forEach((s, i) => {
    const stepNum = i + 1;
    let circleClass = 'gear-verify-step-circle';
    if ((stepNum === 1 && gearState.phoneComplete) || (stepNum === 2 && gearState.idVerified) || (stepNum === 3 && gearState.cardVerified)) {
      circleClass += ' done';
    } else if (stepNum === step) {
      circleClass += ' active';
    }
    const div = document.createElement('div');
    div.className = 'gear-verify-step';
    const isDone = (stepNum === 1 && gearState.phoneComplete) || (stepNum === 2 && gearState.idVerified) || (stepNum === 3 && gearState.cardVerified);
    div.innerHTML = `
      <div class="${circleClass}">${isDone ? '\u2713' : s.icon}</div>
      <span class="gear-verify-step-label">${s.label}</span>
    `;
    stepsEl.appendChild(div);
  });

  // Content area
  const content = document.getElementById('gearVerifyContent');
  const cta = document.getElementById('gearVerifyCta');

  if (step === 1) {
    content.innerHTML = `
      <div class="gear-verify-card">
        <div class="gear-verify-card-header">
          <div class="gear-verify-card-icon">\u{1F4F1}</div>
          <div>
            <span class="gear-verify-card-title">Enter Phone Number</span>
            <span class="gear-verify-card-sub">For rental confirmation</span>
          </div>
        </div>
        <input type="tel" class="gear-phone-input" id="gearPhoneInput" placeholder="(555) 123-4567" maxlength="14">
      </div>
      <div class="gear-verify-info">
        <span class="gear-verify-info-icon">\u{1F6E1}</span>
        <span class="gear-verify-info-text">Your phone number is used only for rental notifications and will not be shared.</span>
      </div>
    `;
    const input = document.getElementById('gearPhoneInput');
    input.addEventListener('input', function() {
      let v = this.value.replace(/\D/g, '');
      if (v.length > 10) v = v.slice(0, 10);
      if (v.length > 6) v = '(' + v.slice(0,3) + ') ' + v.slice(3,6) + '-' + v.slice(6);
      else if (v.length > 3) v = '(' + v.slice(0,3) + ') ' + v.slice(3);
      else if (v.length > 0) v = '(' + v;
      this.value = v;
      gearState.phoneComplete = v.length === 14;
      cta.className = 'demo-btn primary' + (gearState.phoneComplete ? '' : ' disabled');
    });
    cta.textContent = 'Continue';
    cta.className = 'demo-btn primary disabled';
  } else if (step === 2) {
    content.innerHTML = `
      <div class="gear-verify-card">
        <div class="gear-verify-card-header">
          <div class="gear-verify-card-icon">\u{1F4F7}</div>
          <div>
            <span class="gear-verify-card-title">Scan Photo ID</span>
            <span class="gear-verify-card-sub">Quick verification</span>
          </div>
        </div>
        <div class="gear-scan-zone" id="gearIdZone">
          <span class="scan-icon">\u{1F4F7}</span>
          <button class="gear-scan-btn" onclick="gearSimulateIdScan()">Tap to Scan ID</button>
        </div>
      </div>
      <div class="gear-verify-info">
        <span class="gear-verify-info-icon">\u{1F6E1}</span>
        <span class="gear-verify-info-text">We verify you\u2019re 18+ and protect against fraud. Your ID is encrypted and never stored.</span>
      </div>
    `;
    cta.textContent = 'Continue';
    cta.className = 'demo-btn primary disabled';
  } else if (step === 3) {
    const bundle = gearState.selectedBundle;
    content.innerHTML = `
      <div class="gear-verify-card">
        <div class="gear-verify-card-header">
          <div class="gear-verify-card-icon">\u{1F4B3}</div>
          <div>
            <span class="gear-verify-card-title">Payment Hold</span>
            <span class="gear-verify-card-sub">Refundable deposit</span>
          </div>
        </div>
        <div class="gear-scan-zone" id="gearCardZone">
          <span class="scan-icon">\u{1F4B3}</span>
          <button class="gear-scan-btn" onclick="gearSimulateCardVerify()">Authorize Hold</button>
          <div class="gear-payment-rows">
            <div class="gear-payment-row"><span class="label">Rental fee:</span><span class="value">${bundle ? bundle.price : '$12'}</span></div>
            <div class="gear-payment-row"><span class="label">Security deposit:</span><span class="value">$50</span></div>
            <hr class="gear-payment-divider">
            <p class="gear-payment-note">$50 hold released when gear is returned</p>
          </div>
        </div>
      </div>
      <div class="gear-verify-info">
        <span class="gear-verify-info-icon">\u{1F6E1}</span>
        <span class="gear-verify-info-text">We place a temporary hold. You\u2019re only charged the rental fee. The hold is released when you return the gear.</span>
      </div>
    `;
    cta.textContent = 'Unlock Locker';
    cta.className = 'demo-btn primary disabled';
  }
}

function gearSimulateIdScan() {
  const zone = document.getElementById('gearIdZone');
  zone.innerHTML = '<span class="scan-icon" style="font-size:24px;">\u231B</span><span style="font-size:12px;color:var(--dark-text-secondary);">Scanning...</span>';
  setTimeout(() => {
    zone.classList.add('verified');
    zone.innerHTML = '<div style="text-align:center;"><div style="width:48px;height:48px;border-radius:50%;background:var(--dark-green-primary);display:inline-flex;align-items:center;justify-content:center;font-size:20px;color:white;margin-bottom:6px;">\u2713</div><div style="font-size:13px;font-weight:700;color:var(--dark-text-primary);">ID Verified!</div></div>';
    gearState.idVerified = true;
    document.getElementById('gearVerifyCta').className = 'demo-btn primary';
    updateGearVerifyUI();
  }, 1500);
}

function gearSimulateCardVerify() {
  const zone = document.getElementById('gearCardZone');
  zone.innerHTML = '<span class="scan-icon" style="font-size:24px;">\u231B</span><span style="font-size:12px;color:var(--dark-text-secondary);">Authorizing...</span>';
  setTimeout(() => {
    zone.classList.add('verified');
    zone.innerHTML = '<div style="text-align:center;"><div style="width:48px;height:48px;border-radius:50%;background:var(--dark-green-primary);display:inline-flex;align-items:center;justify-content:center;font-size:20px;color:white;margin-bottom:6px;">\u2713</div><div style="font-size:13px;font-weight:700;color:var(--dark-text-primary);">Hold Authorized!</div><div style="font-size:11px;color:var(--dark-text-secondary);margin-top:4px;">Released upon return</div></div>';
    gearState.cardVerified = true;
    document.getElementById('gearVerifyCta').className = 'demo-btn primary';
    updateGearVerifyUI();
  }, 1500);
}

function gearVerifyNext() {
  const cta = document.getElementById('gearVerifyCta');
  if (cta.classList.contains('disabled')) return;

  if (gearState.currentStep === 1 && gearState.phoneComplete) {
    gearState.currentStep = 2;
    updateGearVerifyUI();
  } else if (gearState.currentStep === 2 && gearState.idVerified) {
    gearState.currentStep = 3;
    updateGearVerifyUI();
  } else if (gearState.currentStep === 3 && gearState.cardVerified) {
    go('gear-unlock');
  }
}

// ============================================================
// GEAR UNLOCK
// ============================================================

function renderGearUnlock() {
  gearState.isUnlocked = false;
  const bundle = gearState.selectedBundle;
  const bName = bundle ? bundle.name : 'Your Bundle';
  const bPrice = bundle ? bundle.price : '$12';
  const bDuration = bundle ? bundle.duration : '4 hours';
  const bGear = bundle ? bundle.gear : ['Chairs','Blanket','Speaker'];

  document.getElementById('gearUnlockTitle').textContent = 'Ready to Unlock';
  document.getElementById('gearUnlockSub').textContent = 'Slide to open your locker';

  // Info card
  document.getElementById('gearUnlockInfo').innerHTML = `
    <div class="gear-unlock-info-top">
      <div>
        <div class="gear-unlock-bundle-name">${bName}</div>
        <div class="gear-unlock-bundle-tag">${bundle ? '' : ''}</div>
      </div>
      <span class="gear-unlock-bundle-price">${bPrice}</span>
    </div>
    <div class="gear-unlock-detail-row">
      <div class="gear-unlock-detail-icon">&#128205;</div>
      <div>
        <span class="gear-unlock-detail-label">Locker Location</span>
        <span class="gear-unlock-detail-value">Union Square - Locker #12</span>
      </div>
    </div>
    <div class="gear-unlock-detail-row">
      <div class="gear-unlock-detail-icon">&#9200;</div>
      <div>
        <span class="gear-unlock-detail-label">Rental Duration</span>
        <span class="gear-unlock-detail-value">${bDuration}</span>
      </div>
    </div>
    <div class="gear-unlock-detail-row">
      <div class="gear-unlock-detail-icon">&#128230;</div>
      <div>
        <span class="gear-unlock-detail-label">Items Included</span>
        <span class="gear-unlock-detail-value">${bGear.length} pieces</span>
      </div>
    </div>
    <div class="gear-unlock-items-section">
      <span class="gear-unlock-items-label">Your Gear:</span>
      <div class="gear-unlock-items-list">
        ${bGear.map(item => `<span class="gear-unlock-item-chip">${item}</span>`).join('')}
      </div>
    </div>
  `;

  // Show pre-unlock elements, hide post-unlock
  document.getElementById('gearCountdown').style.display = '';
  document.getElementById('gearSliderSection').style.display = '';
  document.getElementById('gearSuccessCard').style.display = 'none';
  document.getElementById('gearUnlockActions').style.display = 'none';
  document.getElementById('gearLockOverlay').style.display = '';
  document.getElementById('gearUnlockInfo').style.display = '';

  // Countdown
  let countdown = 300;
  document.getElementById('gearCountdownTime').textContent = '5:00';
  if (gearState.countdownTimer) clearInterval(gearState.countdownTimer);
  gearState.countdownTimer = setInterval(() => {
    if (gearState.isUnlocked) return;
    countdown--;
    if (countdown < 0) countdown = 0;
    const m = Math.floor(countdown / 60);
    const s = countdown % 60;
    document.getElementById('gearCountdownTime').textContent = m + ':' + String(s).padStart(2, '0');
  }, 1000);

  // Slider interaction
  initGearSlider();
}

function initGearSlider() {
  const thumb = document.getElementById('gearSliderThumb');
  const track = document.getElementById('gearSliderTrack');
  let isDragging = false;
  let startX = 0;
  let currentX = 0;
  const maxDrag = 220;

  function onStart(e) {
    isDragging = true;
    startX = (e.touches ? e.touches[0].clientX : e.clientX) - currentX;
    thumb.style.transition = 'none';
  }
  function onMove(e) {
    if (!isDragging) return;
    e.preventDefault();
    const clientX = e.touches ? e.touches[0].clientX : e.clientX;
    let dx = clientX - startX;
    if (dx < 0) dx = 0;
    if (dx > maxDrag) dx = maxDrag;
    currentX = dx;
    thumb.style.left = (6 + dx) + 'px';
    const labelEl = document.getElementById('gearSliderLabel');
    labelEl.style.opacity = 1 - (dx / maxDrag);
    if (dx > maxDrag * 0.85) {
      track.style.background = 'var(--brand-ochre)';
    } else {
      track.style.background = '';
    }
  }
  function onEnd() {
    if (!isDragging) return;
    isDragging = false;
    thumb.style.transition = 'left 0.3s ease';
    if (currentX > maxDrag * 0.75) {
      // Unlocked!
      gearState.isUnlocked = true;
      triggerGearUnlockSuccess();
    } else {
      currentX = 0;
      thumb.style.left = '6px';
      document.getElementById('gearSliderLabel').style.opacity = 1;
      track.style.background = '';
    }
  }

  // Clean up old listeners by cloning
  const newThumb = thumb.cloneNode(true);
  thumb.parentNode.replaceChild(newThumb, thumb);

  newThumb.addEventListener('mousedown', onStart);
  newThumb.addEventListener('touchstart', onStart, { passive: true });
  document.addEventListener('mousemove', onMove);
  document.addEventListener('touchmove', onMove, { passive: false });
  document.addEventListener('mouseup', onEnd);
  document.addEventListener('touchend', onEnd);
}

function triggerGearUnlockSuccess() {
  const bundle = gearState.selectedBundle;
  const bDuration = bundle ? bundle.duration : '4 hours';

  document.getElementById('gearUnlockTitle').textContent = 'Locker Open!';
  document.getElementById('gearUnlockSub').textContent = 'Grab your gear and go';

  // Hide pre-unlock, show post-unlock
  document.getElementById('gearCountdown').style.display = 'none';
  document.getElementById('gearSliderSection').style.display = 'none';
  document.getElementById('gearLockOverlay').style.display = 'none';

  const successCard = document.getElementById('gearSuccessCard');
  successCard.style.display = '';
  successCard.innerHTML = `
    <div class="gear-success-icon">&#128275;</div>
    <div class="gear-success-title">Locker #12 is Open</div>
    <div class="gear-success-text">Retrieve your gear and have an amazing adventure!</div>
  `;

  document.getElementById('gearUnlockActions').style.display = '';
  document.getElementById('gearReturnNote').textContent = 'Remember to return your gear to any locker within ' + bDuration;

  if (gearState.countdownTimer) clearInterval(gearState.countdownTimer);
}

// ============================================================
// TAB BAR
// ============================================================

const TABS = [
  { id: 'home', label: 'Home', icon: '&#9750;' },
  { id: 'map', label: 'Map', icon: '&#9873;' },
  { id: 'groups', label: 'Groups', icon: '&#9883;' },
  { id: 'leaderboard', label: 'Board', icon: '&#9813;' },
  { id: 'rewards', label: 'Rewards', icon: '&#9733;' },
  { id: 'profile', label: 'Profile', icon: '&#9679;' }
];

const TAB_SCREENS = ['home', 'gallery', 'map', 'groups', 'leaderboard', 'rewards', 'profile'];

function renderTabBar(activeScreen) {
  // Map gallery to home tab highlight
  const activeTab = activeScreen === 'gallery' ? 'home' : activeScreen;
  const bars = document.querySelectorAll('.tab-bar');
  bars.forEach(bar => {
    bar.innerHTML = '';
    TABS.forEach(tab => {
      const span = document.createElement('span');
      span.className = 'tab-item' + (tab.id === activeTab ? ' active' : '');
      span.innerHTML = tab.label;
      span.onclick = () => go(tab.id);
      bar.appendChild(span);
    });
  });
}

// ============================================================
// INIT
// ============================================================

(function init() {
  // Build progress dots
  const dotsEl = document.getElementById('demoDots');
  SCREEN_ORDER.forEach((s, i) => {
    const dot = document.createElement('div');
    dot.className = 'demo-dot' + (i === 0 ? ' active' : '');
    dotsEl.appendChild(dot);
  });
})();
</script>

</body>
</html>
